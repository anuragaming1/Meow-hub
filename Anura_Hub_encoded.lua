
local base64 = {}

function base64.decode(data)
    local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    data = string.gsub(data, '[^'..b..'=]', '')
    return (data:gsub('.', function(x)
        if x == '=' then return '' end
        local r, f = '', (b:find(x) - 1)
        for i = 6, 1, -1 do r = r .. (f % 2 ^ i - f % 2 ^ (i - 1) > 0 and '1' or '0') end
        return r
    end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
        if #x ~= 8 then return '' end
        local c = 0
        for i = 1, 8 do c = c + (x:sub(i, i) == '1' and 2 ^ (8 - i) or 0) end
        return string.char(c)
    end))
end

local encoded_script = "LS0tZGVvYmYgQnkgQW51cmEKLS0tZGVvYmYgQnkgQW51cmEKLS0tZGVvYmYgQnkgQW51cmEKLS0tZGVvYmYgQnkgQW51cmEKZnVuY3Rpb24gc2V0VGVhbSh0ZWFtTmFtZSkKICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgWzFdID0gIlNldFRlYW0iLAogICAgICAgIFsyXSA9IHRlYW1OYW1lCiAgICB9CiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKZW5kCgpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBfRy5TZWxlY3RfUGlyYXRlcyB0aGVuCiAgICAgICAgICAgIHNldFRlYW0oIlBpcmF0ZXMiKQogICAgICAgICAgICBfRy5TZWxlY3RfUGlyYXRlcyA9IGZhbHNlICAKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLlNlbGVjdF9NYXJpbmVzIHRoZW4KICAgICAgICAgICAgc2V0VGVhbSgiTWFyaW5lcyIpCiAgICAgICAgICAgIF9HLlNlbGVjdF9NYXJpbmVzID0gZmFsc2UgIAogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIFNjcmVlbkd1aSA9IEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIikKbG9jYWwgVGV4dExhYmVsID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQpsb2NhbCBVSUdyYWRpZW50ID0gSW5zdGFuY2UubmV3KCJVSUdyYWRpZW50IikKU2NyZWVuR3VpLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIlBsYXllckd1aSIpClNjcmVlbkd1aS5aSW5kZXhCZWhhdmlvciA9IEVudW0uWkluZGV4QmVoYXZpb3IuU2libGluZwpUZXh0TGFiZWwuUGFyZW50ID0gU2NyZWVuR3VpClRleHRMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKVGV4dExhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLjAwMApUZXh0TGFiZWwuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKVGV4dExhYmVsLkJvcmRlclNpemVQaXhlbCA9IDAKVGV4dExhYmVsLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwLjUpClRleHRMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIC0wLjAyNSwgMCkKVGV4dExhYmVsLlNpemUgPSBVRGltMi5uZXcoMCwgMjAwLCAwLCA1MCkKVGV4dExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuRnJlZG9rYU9uZQpUZXh0TGFiZWwuVGV4dCA9ICJodHRwczovL2Rpc2NvcmQuZ2cvcEduNnhzbWZTZyIKVGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQpUZXh0TGFiZWwuVGV4dFNpemUgPSAyMC4wMAoKVUlHcmFkaWVudC5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3ewoJQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb2xvcjMuZnJvbVJHQigxMzEuMDAwMDA3MzkwOTc1OTUsIDE4MS4wMDAwMDQ0MTA3NDM3LCAyNTUpKSwKCUNvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29sb3IzLmZyb21SR0IoMjI0LjAwMDAwMTg0Nzc0NCwgMTYyLjAwMDAwNTU0MzIzMTk2LCAyNTUpKQp9ClVJR3JhZGllbnQuUGFyZW50ID0gVGV4dExhYmVsCgpsb2NhbCBTY3JlZW5HdWkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIpOwpsb2NhbCBEcm9wU2hhZG93SG9sZGVyID0gSW5zdGFuY2UubmV3KCJGcmFtZSIpOwpsb2NhbCBEcm9wU2hhZG93ID0gSW5zdGFuY2UubmV3KCJJbWFnZUxhYmVsIik7CmxvY2FsIE1haW4gPSBJbnN0YW5jZS5uZXcoIkZyYW1lIik7CmxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpOwpsb2NhbCBVSVN0cm9rZSA9IEluc3RhbmNlLm5ldygiVUlTdHJva2UiKTsKbG9jYWwgVUlHcmFkaWVudCA9IEluc3RhbmNlLm5ldygiVUlHcmFkaWVudCIpOwpsb2NhbCBUID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKTsKbG9jYWwgVUlHcmFkaWVudDEgPSBJbnN0YW5jZS5uZXcoIlVJR3JhZGllbnQiKTsKClNjcmVlbkd1aS5aSW5kZXhCZWhhdmlvciA9IEVudW0uWkluZGV4QmVoYXZpb3IuU2libGluZwpTY3JlZW5HdWkuUGFyZW50ID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpCgpEcm9wU2hhZG93SG9sZGVyLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwLjUpCkRyb3BTaGFkb3dIb2xkZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKRHJvcFNoYWRvd0hvbGRlci5Cb3JkZXJTaXplUGl4ZWwgPSAwCkRyb3BTaGFkb3dIb2xkZXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLjEsIDApCkRyb3BTaGFkb3dIb2xkZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCA1MDAsIDAsIDY4KQpEcm9wU2hhZG93SG9sZGVyLlpJbmRleCA9IDAKRHJvcFNoYWRvd0hvbGRlci5OYW1lID0gIkRyb3BTaGFkb3dIb2xkZXIiCkRyb3BTaGFkb3dIb2xkZXIuUGFyZW50ID0gU2NyZWVuR3VpCgpEcm9wU2hhZG93LkltYWdlID0gInJieGFzc2V0aWQ6Ly8xNDE5MDI2MjcyMSIKRHJvcFNoYWRvdy5JbWFnZUNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCkRyb3BTaGFkb3cuSW1hZ2VUcmFuc3BhcmVuY3kgPSAwLjUKRHJvcFNoYWRvdy5TY2FsZVR5cGUgPSBFbnVtLlNjYWxlVHlwZS5TbGljZQpEcm9wU2hhZG93LlNsaWNlQ2VudGVyID0gUmVjdC5uZXcoNDksIDQ5LCA0NTAsIDQ1MCkKRHJvcFNoYWRvdy5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KQpEcm9wU2hhZG93LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCkRyb3BTaGFkb3cuQm9yZGVyU2l6ZVBpeGVsID0gMApEcm9wU2hhZG93LlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMC41LCAwKQpEcm9wU2hhZG93LlNpemUgPSBVRGltMi5uZXcoMSwgNDcsIDEsIDQ3KQpEcm9wU2hhZG93LlpJbmRleCA9IDAKRHJvcFNoYWRvdy5OYW1lID0gIkRyb3BTaGFkb3ciCkRyb3BTaGFkb3cuUGFyZW50ID0gRHJvcFNoYWRvd0hvbGRlcgoKTWFpbi5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KQpNYWluLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQpNYWluLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjUKTWFpbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQpNYWluLkJvcmRlclNpemVQaXhlbCA9IDAKTWFpbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAuNSwgMCkKTWFpbi5TaXplID0gVURpbTIubmV3KDEsIC00NywgMSwgLTQ3KQpNYWluLk5hbWUgPSAiTWFpbiIKTWFpbi5QYXJlbnQgPSBEcm9wU2hhZG93CgpVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA1KQpVSUNvcm5lci5QYXJlbnQgPSBNYWluCgpVSVN0cm9rZS5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpClVJU3Ryb2tlLlRoaWNrbmVzcyA9IDIuNQpVSVN0cm9rZS5QYXJlbnQgPSBNYWluCgpVSUdyYWRpZW50LkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7CglDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIENvbG9yMy5mcm9tUkdCKDEzMS4wMDAwMDczOTA5NzU5NSwgMTgxLjAwMDAwNDQxMDc0MzcsIDI1NSkpLAoJQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCBDb2xvcjMuZnJvbVJHQigyMjQuMDAwMDAxODQ3NzQ0LCAxNjIuMDAwMDA1NTQzMjMxOTYsIDI1NSkpCn0KVUlHcmFkaWVudC5QYXJlbnQgPSBVSVN0cm9rZQoKVC5Gb250ID0gRW51bS5Gb250LkdvdGhhbUJvbGQKVC5UZXh0ID0gIkFudXJhIEh1YiIKVC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKVC5UZXh0U2l6ZSA9IDE2LjUKVC5UZXh0WUFsaWdubWVudCA9IEVudW0uVGV4dFlBbGlnbm1lbnQuQm90dG9tClQuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDApClQuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpClQuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuOTk5MDAwMDEyODc0NjAzMwpULkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApClQuQm9yZGVyU2l6ZVBpeGVsID0gMApULlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMCwgMTUpClQuU2l6ZSA9IFVEaW0yLm5ldygwLCA1MDAsIDAsIDE4KQpULk5hbWUgPSAiVG9wIgpULlBhcmVudCA9IE1haW4KClVJR3JhZGllbnQxLkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7CglDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIENvbG9yMy5mcm9tUkdCKDEzMS4wMDAwMDczOTA5NzU5NSwgMTgxLjAwMDAwNDQxMDc0MzcsIDI1NSkpLAoJQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCBDb2xvcjMuZnJvbVJHQigyMjQuMDAwMDAxODQ3NzQ0LCAxNjIuMDAwMDA1NTQzMjMxOTYsIDI1NSkpCn0KVUlHcmFkaWVudDEuUGFyZW50ID0gVAoKVC5TaXplID0gVURpbTIubmV3KDAsIFQuVGV4dEJvdW5kcy5YLCAwLCAxOCkKaWYgVC5TaXplLlguT2Zmc2V0IHRoZW4KCURyb3BTaGFkb3dIb2xkZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCBULlRleHRCb3VuZHMuWCArIDY4LCAwLCA0OCkKZW5kClQ6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCJUZXh0Iik6Q29ubmVjdChmdW5jdGlvbigpCglULlNpemUgPSBVRGltMi5uZXcoMCwgVC5UZXh0Qm91bmRzLlgsIDAsIDE4KQoJaWYgVC5TaXplLlguT2Zmc2V0IHRoZW4KCQlEcm9wU2hhZG93SG9sZGVyLlNpemUgPSBVRGltMi5uZXcoMCwgVC5UZXh0Qm91bmRzLlggKyA2OCwgMCwgNDgpCgllbmQKZW5kKQoKZnVuY3Rpb24gU2V0VGl0bGUodikKCVQuVGV4dCA9IHYKZW5kCgpsb2NhbCBOb3RpZmljYXRpb25MaWJyYXJ5ID0gbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9sb2JveDkyMC9Ob3RpZmljYXRpb24tTGlicmFyeS9NYWluL0xpYnJhcnkubHVhIikpKCkKCk5vdGlmaWNhdGlvbkxpYnJhcnk6U2VuZE5vdGlmaWNhdGlvbigiV2FybmluZyIsICJD4bupIHThu6sgdOG7qy4uLiIsIDEwKQpOb3RpZmljYXRpb25MaWJyYXJ5OlNlbmROb3RpZmljYXRpb24oIldhcm5pbmciLCAiSGkgLCBEw7luZyB0aOG6pXkgxJHGsOG7o2Mga2jDtG5nIiwgMTApCk5vdGlmaWNhdGlvbkxpYnJhcnk6U2VuZE5vdGlmaWNhdGlvbigiV2FybmluZyIsICJodHRwczovL2Rpc2NvcmQuZ2cvcEduNnhzbWZTZyIsIDEwKQoKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgaWYgX0cuU2VsZWN0X01hcmluZXMgdGhlbgogICAgICAgICAgICBzZXRUZWFtKCJNYXJpbmVzIikKICAgICAgICAgICAgX0cuU2VsZWN0X01hcmluZXMgPSBmYWxzZSAgCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKZnVuY3Rpb24gQXV0b0hha2koKQogIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogIGlmIGNoYXJhY3RlciBhbmQgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFzQnVzbyIpIHRoZW4KICAgIGxvY2FsIHJlbW90ZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXwogICAgaWYgcmVtb3RlIHRoZW4KICAgICAgcmVtb3RlOkludm9rZVNlcnZlcigiQnVzbyIpIAogICAgZW5kCiAgZW5kCmVuZAogICAgCiAgICBmdW5jdGlvbiBVbkVxdWlwV2VhcG9uKFdlYXBvbikKICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKFdlYXBvbikgdGhlbgogICAgICAgICAgICBfRy5Ob3RBdXRvRXF1aXAgPSB0cnVlCiAgICAgICAgICAgIHdhaXQoLjUpCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoV2VhcG9uKS5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICAgICAgd2FpdCguMSkKICAgICAgICAgICAgX0cuTm90QXV0b0VxdWlwID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAoKZnVuY3Rpb24gRXF1aXBXZWFwb24oVG9vbFNlKQoJaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKFRvb2xTZSkgdGhlbgoJCWxvY2FsIHRvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoVG9vbFNlKQoJCXdhaXQoLjQpCgkJZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wodG9vbCkKCWVuZAplbmQgICAgCiAgICAKICAgIGZ1bmN0aW9uIEVxdWlwV2VhcG9uKFRvb2xTZSkKICAgICAgICBpZiBub3QgX0cuTm90QXV0b0VxdWlwIHRoZW4KICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKFRvb2xTZSkgdGhlbgogICAgICAgICAgICAgICAgVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZChUb29sU2UpCiAgICAgICAgICAgICAgICB3YWl0KC4xKQogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woVG9vbCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAKICAgIGZ1bmN0aW9uIEdldERpc3RhbmNlKHRhcmdldCkKICAgICAgICByZXR1cm4gbWF0aC5mbG9vcigodGFyZ2V0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUpCiAgICBlbmQKICAgIAogICAgZnVuY3Rpb24gQlRQKHApCiAgICAJcGNhbGwoZnVuY3Rpb24oKQoJICAgIAlpZiAocC5Qb3NpdGlvbi1nYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA+PSAxNTAwIGFuZCBub3QgQXV0b19SYWlkIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgoJCQkJcmVwZWF0IHdhaXQoKQoJCQkJCWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBwCgkJCQkJd2FpdCgwLjUpCgkJCQkJZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkOkRlc3Ryb3koKQoJCQkJCWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBwCgkJCQl1bnRpbCAocC5Qb3NpdGlvbi1nYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8IDE1MDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoID4gMAoJCQllbmQKCQllbmQpCgllbmQKICAgIGZ1bmN0aW9uIFRQKFBvcykKICAgICAgICBEaXN0YW5jZSA9IChQb3MuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgaWYgRGlzdGFuY2UgPCAzMDAgdGhlbgogICAgICAgICAgICBTcGVlZCA9IDMwMAogICAgICAgIGVsc2VpZiBEaXN0YW5jZSA+PSAxMDAwIHRoZW4KICAgICAgICAgICAgU3BlZWQgPSAzMDAKICAgICAgICBlbmQKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpOkNyZWF0ZSgKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQsCiAgICAgICAgICAgIFR3ZWVuSW5mby5uZXcoRGlzdGFuY2UvU3BlZWQsIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyKSwKICAgICAgICAgICAge0NGcmFtZSA9IFBvc30KICAgICAgICApOlBsYXkoKQogICAgICAgIF9HLkNsaXAgPSB0cnVlCiAgICAgICAgd2FpdChEaXN0YW5jZS9TcGVlZCkKICAgICAgICBfRy5DbGlwID0gZmFsc2UKICAgIGVuZAoKZnVuY3Rpb24gTWluaERlcFphaShQb3MpCiAgICAgICAgRGlzdGFuY2UgPSAoUG9zLlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlNpdCA9PSB0cnVlIHRoZW4gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5TaXQgPSBmYWxzZSBlbmQKICAgICAgICBwY2FsbChmdW5jdGlvbigpIHR3ZWVuID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKTpDcmVhdGUoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LFR3ZWVuSW5mby5uZXcoRGlzdGFuY2UvMzE1LCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhcikse0NGcmFtZSA9IFBvc30pIGVuZCkKICAgICAgICB0d2VlbjpQbGF5KCkKICAgICAgICBpZiBEaXN0YW5jZSA8PSAyMDAgdGhlbgogICAgICAgICAgICB0d2VlbjpDYW5jZWwoKQogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zCiAgICAgICAgZW5kCiAgICAgICAgaWYgX0cuU3RvcFR3ZWVuID09IHRydWUgdGhlbgogICAgICAgICAgICB0d2VlbjpDYW5jZWwoKQogICAgICAgICAgICBfRy5DbGlwID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZ1bmN0aW9uIENoZWNrTmVhcmVzdFRlbGVwb3J0ZXIoYUkpCiAgICAgICAgbG9jYWwgTXlMZXZlbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EYXRhLkxldmVsLlZhbHVlCiAgICAgICAgdmNzcG9zID0gYUkuUG9zaXRpb24KICAgICAgICBtaW4gPSBtYXRoLmh1Z2UKICAgICAgICBtaW4yID0gbWF0aC5odWdlCiAgICAgICAgbG9jYWwgeSA9IGdhbWUuUGxhY2VJZAogICAgICAgIGlmIHkgPT0gMjc1MzkxNTU0OSB0aGVuCiAgICAgICAgICAgIE9sZFdvcmxkID0gdHJ1ZQogICAgICAgIGVsc2VpZiB5ID09IDQ0NDIyNzIxODMgdGhlbgogICAgICAgICAgICBOZXdXb3JsZCA9IHRydWUKICAgICAgICBlbHNlaWYgeSA9PSA3NDQ5NDIzNjM1IHRoZW4KICAgICAgICAgICAgVGhyZWVXb3JsZCA9IHRydWUKICAgICAgICBlbmQgIAogICAgICAgIGlmIFdvcmxkMyB0aGVuCiAgICAgICAgICAgIFRhYmxlTG9jYXRpb25zID0gewogICAgICAgICAgICAgICAgWyJDYXNsdGUgT24gVGhlIFNlYSJdID0gVmVjdG9yMy5uZXcoLTUwNTguNzc0OTAyMzQzNzUsIDMxNC41MTU1MDI5Mjk2ODc1LCAtMzE1NS44ODMzMDA3ODEyNSksCiAgICAgICAgICAgICAgICBbIkh5ZHJhIl0gPSBWZWN0b3IzLm5ldyg1NjYxLjUzMDI3MzQzNzUsIDEwMTMuMzU4NzAzNjEzMjgxMiwgLTMzNC45NjE5MTQwNjI1KSwKICAgICAgICAgICAgICAgIFsiTWFuc2lvbiJdID0gVmVjdG9yMy5uZXcoLTEyNDYzLjg3NDAyMzQzNzUsIDM3NC45MTQ0NTkyMjg1MTU2LCAtNzUyMy43NzM5MjU3ODEyNSksCiAgICAgICAgICAgICAgICBbIkdyZWF0IFRyZWUiXSA9IFZlY3RvcjMubmV3KDI4MjgyLjU3MDMxMjUsIDE0ODk2Ljg1MDU4NTkzNzUsIDEwNS4xMDQyNzA5MzUwNTg2KSwKICAgICAgICAgICAgICAgIFsiTmd1MSJdID0gVmVjdG9yMy5uZXcoLTExOTkzLjU4MDA3ODEyNSwgMzM0Ljc4MTI4MDUxNzU3ODEsIC04ODQ0LjE4MjYxNzE4NzUpLAogICAgICAgICAgICAgICAgWyJuZ3UyIl0gPSBWZWN0b3IzLm5ldyg1MzE0LjU4MjAzMTI1LCAyNS40MTkzODc4MTczODI4MTIsIC0xMjUuOTQyMjc2MDAwOTc2NTYpCiAgICAgICAgICAgIH0KICAgICAgICBlbHNlaWYgV29ybGQyIHRoZW4KICAgICAgICAgICAgVGFibGVMb2NhdGlvbnMgPSB7CiAgICAgICAgICAgICAgICBbIk1hbnNpb24iXSA9IFZlY3RvcjMubmV3KC0yODguNDYyNDYzMzc4OTA2MjUsIDMwNi4xMzA2MTUyMzQzNzUsIDU5Ny45OTg4NDAzMzIwMzEyKSwKICAgICAgICAgICAgICAgIFsiRmxhbWluZ28iXSA9IFZlY3RvcjMubmV3KDIyODQuOTEyMTA5Mzc1LCAxNS4xNTIwNDYyMDM2MTMyODEsIDkwNS40ODI5MTAxNTYyNSksCiAgICAgICAgICAgICAgICBbIjEyMiJdID0gVmVjdG9yMy5uZXcoOTIzLjIxMjUyNDQxNDA2LCAxMjYuOTc2MDA1NTU0MiwgMzI4NTIuODMyMDMxMjUpLAogICAgICAgICAgICAgICAgWyIzMDMyIl0gPSBWZWN0b3IzLm5ldygtNjUwOC41NTgxMDU0Njg4LCA4OS4wMzQ5OTYwMzI3MTUsIC0xMzIuODM5NTM4NTc0MjIpCiAgICAgICAgICAgIH0KICAgICAgICBlbHNlaWYgV29ybGQxIHRoZW4KICAgICAgICAgICAgVGFibGVMb2NhdGlvbnMgPSB7CiAgICAgICAgICAgICAgICBbIjEiXSA9IFZlY3RvcjMubmV3KC03ODk0LjYyMDExNzE4NzUsIDU1NDUuNDkxNjk5MjE4NzUsIC0zODAuMjQ2NzM0NjE5MTQwNiksCiAgICAgICAgICAgICAgICBbIjIiXSA9IFZlY3RvcjMubmV3KC00NjA3LjgyMjc1MzkwNjI1LCA4NzIuNTQyMjk3MzYzMjgxMiwgLTE2NjcuNTU2ODg0NzY1NjI1KSwKICAgICAgICAgICAgICAgIFsiMyJdID0gVmVjdG9yMy5uZXcoNjExNjMuODUxNTYyNSwgMTEuNzU5NTIyNDM4MDQ5MzE2LCAxODE5Ljc4NDE3OTY4NzUpLAogICAgICAgICAgICAgICAgWyI0Il0gPSBWZWN0b3IzLm5ldygzODc2LjI4MDUxNzU3ODEyNSwgMzUuMTA2MTQwMTM2NzE4NzUsIC0xOTM5LjMyMDE5MDQyOTY4NzUpCiAgICAgICAgICAgIH0KICAgICAgICBlbmQKICAgICAgICBUYWJsZUxvY2F0aW9uczIgPSB7fQogICAgICAgIGZvciByLCB2IGluIHBhaXJzKFRhYmxlTG9jYXRpb25zKSBkbwogICAgICAgICAgICBUYWJsZUxvY2F0aW9uczJbcl0gPSAodiAtIHZjc3BvcykuTWFnbml0dWRlCiAgICAgICAgZW5kCiAgICAgICAgZm9yIHIsIHYgaW4gcGFpcnMoVGFibGVMb2NhdGlvbnMyKSBkbwogICAgICAgICAgICBpZiB2IDwgbWluIHRoZW4KICAgICAgICAgICAgICAgIG1pbiA9IHYKICAgICAgICAgICAgICAgIG1pbjIgPSB2CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGZvciByLCB2IGluIHBhaXJzKFRhYmxlTG9jYXRpb25zMikgZG8KICAgICAgICAgICAgaWYgdiA8IG1pbiB0aGVuCiAgICAgICAgICAgICAgICBtaW4gPSB2CiAgICAgICAgICAgICAgICBtaW4yID0gdgogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBmb3IgciwgdiBpbiBwYWlycyhUYWJsZUxvY2F0aW9uczIpIGRvCiAgICAgICAgICAgIGlmIHYgPD0gbWluIHRoZW4KICAgICAgICAgICAgICAgIGNob29zZSA9IFRhYmxlTG9jYXRpb25zW3JdCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIG1pbjMgPSAodmNzcG9zIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICBpZiBtaW4yIDw9IG1pbjMgdGhlbgogICAgICAgICAgICByZXR1cm4gY2hvb3NlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgZnVuY3Rpb24gcmVxdWVzdEVudHJhbmNlKGFKKQogICAgICAgIGFyZ3MgPSB7InJlcXVlc3RFbnRyYW5jZSIsIGFKfQogICAgICAgIGdhbWUuUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICBvbGRjZnJhbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydAogICAgICAgIGNoYXIuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhvbGRjZnJhbWUuWCwgb2xkY2ZyYW1lLlkgKyA1MCwgb2xkY2ZyYW1lLlopCiAgICAgICAgdGFzay53YWl0KDAuNSkKICAgIGVuZAogICAgCiAgICBmdW5jdGlvbiBBbnRpTG93SGVhbHRoKGFLKQogICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPQogICAgICAgICAgICBDRnJhbWUubmV3KAogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlgsCiAgICAgICAgICAgIGFLLAogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLloKICAgICAgICApCiAgICAgICAgd2FpdCgpCiAgICBlbmQKICAgIFR3ZWVuU3BlZWQgPSAzMDAKICAgIGZ1bmN0aW9uIHRvcG9zKGFMKQogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyIGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBUd2VlblNwZWVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW5TcGVlZCA9IDMwMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIERlZnVhbHRZID0gYUwuWQogICAgICAgICAgICAgICAgICAgIFRhcmdldFkgPSBhTC5ZCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Q0ZyYW1lV2l0aERlZnVhbHRZID0gQ0ZyYW1lLm5ldyhhTC5YLCBEZWZ1YWx0WSwgYUwuWikKICAgICAgICAgICAgICAgICAgICB0YXJnZXRQb3MgPSBhTC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIG9sZGNmcmFtZSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICBEaXN0YW5jZSA9ICh0YXJnZXRQb3MgLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgIGlmIERpc3RhbmNlIDw9IDMwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBhTAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFNID0gQ2hlY2tOZWFyZXN0VGVsZXBvcnRlcihhTCkKICAgICAgICAgICAgICAgICAgICBpZiBhTSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0d2VlbjpDYW5jZWwoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0RW50cmFuY2UoYU0pCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgYjEgPSBDRnJhbWUubmV3KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWCxEZWZ1YWx0WSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlopCiAgICAgICAgICAgICAgICAgICAgaWYgSW5nb3JlWSBhbmQgKGIxLlBvc2l0aW9uIC0gdGFyZ2V0Q0ZyYW1lV2l0aERlZnVhbHRZLlBvc2l0aW9uKS5NYWduaXR1ZGUgPiA1IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5YLERlZnVhbHRZLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHdlZW5mdW5jID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYU4gPSBnYW1lOnNlcnZpY2UgIlR3ZWVuU2VydmljZSIKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYU8gPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW5JbmZvLm5ldygodGFyZ2V0UG9zIC1nYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuUG9zaXRpb24pLk1hZ25pdHVkZSAvVHdlZW5TcGVlZCxFbnVtLkVhc2luZ1N0eWxlLkxpbmVhcikKICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW4gPSBhTjpDcmVhdGUoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyWyJIdW1hbm9pZFJvb3RQYXJ0Il0sYU8se0NGcmFtZSA9IHRhcmdldENGcmFtZVdpdGhEZWZ1YWx0WX0pCiAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuOlBsYXkoKQogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB0d2VlbmZ1bmM6U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0d2VlbjpDYW5jZWwoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW4uQ29tcGxldGVkOldhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlgsVGFyZ2V0WSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlopCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0d2VlbmZ1bmMgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhTiA9IGdhbWU6c2VydmljZSAiVHdlZW5TZXJ2aWNlIgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhTyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUd2VlbkluZm8ubmV3KCh0YXJnZXRQb3MgLWdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKS5Qb3NpdGlvbikuTWFnbml0dWRlIC9Ud2VlblNwZWVkLEVudW0uRWFzaW5nU3R5bGUuTGluZWFyKQogICAgICAgICAgICAgICAgICAgICAgICB0d2VlbiA9IGFOOkNyZWF0ZShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXJbIkh1bWFub2lkUm9vdFBhcnQiXSxhTyx7Q0ZyYW1lID0gYUx9KQogICAgICAgICAgICAgICAgICAgICAgICB0d2VlbjpQbGF5KCkKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gdHdlZW5mdW5jOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW46Q2FuY2VsKCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuLkNvbXBsZXRlZDpXYWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9Q0ZyYW1lLm5ldyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlgsVGFyZ2V0WSxnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlopCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHR3ZWVuIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR3ZWVuCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR3ZWVuZnVuYwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICkKICAgIGVuZApJbmdvcmVZID0gdHJ1ZQpUeXBlID0gMQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KC4xKSBkbwoJCWlmIFR5cGUgPT0gMSB0aGVuCgkJCVBvcyA9IENGcmFtZS5uZXcoMCxQb3NZLC0zMCkKCQllbHNlaWYgVHlwZSA9PSAyIHRoZW4KCQkJUG9zID0gQ0ZyYW1lLm5ldygzMCxQb3NZLDApCgkJZWxzZWlmIFR5cGUgPT0gMyB0aGVuCgkJCVBvcyA9IENGcmFtZS5uZXcoMCxQb3NZLDMwKQkKCQllbHNlaWYgVHlwZSA9PSA0IHRoZW4KCQkJUG9zID0gQ0ZyYW1lLm5ldygtMzAsUG9zWSwwKQogICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQoKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgwLjUpIGRvCiAgICAgICAgVHlwZSA9IDEKICAgICAgICB3YWl0KDAuNCkKICAgICAgICBUeXBlID0gMgogICAgICAgIHdhaXQoMC4zKQogICAgICAgIFR5cGUgPSAzCiAgICAgICAgd2FpdCgwLjQpCiAgICAgICAgVHlwZSA9IDQKICAgICAgICB3YWl0KDAuMikKICAgICAgICBUeXBlID0gNQogICAgICAgIHdhaXQoMC4zKQogICAgZW5kCmVuZCkKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoLjEpIGRvCiAgICAgICAgRnJhbWUgPSAxCiAgICAgICAgd2FpdCgwLjQpCiAgICAgICAgRnJhbWUgPSAyCiAgICAgICAgd2FpdCgwLjQpCiAgICAgICAgRnJhbWUgPSAzCiAgICAgICAgd2FpdCgwLjMpCiAgICAgICAgRnJhbWUgPSA0CiAgICAgICAgd2FpdCgwLjQpCiAgICAgICAgRnJhbWUgPSA1CiAgICAgICAgd2FpdCgwLjMpCiAgICBlbmQKZW5kKQoKVHlwZSA9IDEKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCguMSkgZG8KICAgICAgICBpZiBGcmFtZSA9PSAxIHRoZW4KICAgICAgICAgICAgQ2hlY2sgPSBDRnJhbWUubmV3KDAsNTAsMCkKCQllbHNlaWYgRiA9PSAyIHRoZW4KCQkJQ2hlY2sgPSBDRnJhbWUubmV3KDAsMCwtMTAwKQoJCWVsc2VpZiBGID09IDMgdGhlbgoJCQlDaGVjayA9IENGcmFtZS5uZXcoMTAwLDAsMCkKCQllbHNlaWYgRiA9PSA0IHRoZW4KCQkJQ2hlY2sgPSBDRnJhbWUubmV3KDAsMCwxMDApCQoJCWVsc2VpZiBGID09IDUgdGhlbgoJCQlDaGVjayA9IENGcmFtZS5uZXcoLTEwMCwwLDApCgkJZWxzZWlmIEYgPT0gNiB0aGVuCgkJCUNoZWNrID0gQ0ZyYW1lLm5ldygwLDUwLDApCiAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCgpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KC4xKSBkbwogICAgICAgIEYgPSAxCiAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgRiA9IDIKICAgICAgICB3YWl0KDAuNSkKICAgICAgICBGID0gMwogICAgICAgIHdhaXQoMC41KQogICAgICAgIEYgPSA0CiAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgRiA9IDUKICAgICAgICB3YWl0KDAuNSkKICAgIGVuZAplbmQpCgoKZnVuY3Rpb24gVFBCKENGZ28pCmxvY2FsIHR3ZWVuX3MgPSBnYW1lOnNlcnZpY2UiVHdlZW5TZXJ2aWNlIgpsb2NhbCBpbmZvID0gVHdlZW5JbmZvLm5ldygoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5Cb2F0cy5QaXJhdGVCcmlnYWRlLlZlaGljbGVTZWF0LkNGcmFtZS5Qb3NpdGlvbiAtIENGZ28uUG9zaXRpb24pLk1hZ25pdHVkZS8zMDAsIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyKQp0d2VlbiA9IHR3ZWVuX3M6Q3JlYXRlKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQm9hdHMuUGlyYXRlQnJpZ2FkZS5WZWhpY2xlU2VhdCwgaW5mbywge0NGcmFtZSA9IENGZ299KQp0d2VlbjpQbGF5KCkKCmxvY2FsIHR3ZWVuZnVuYyA9IHt9CgpmdW5jdGlvbiB0d2VlbmZ1bmM6U3RvcCgpCiAgICB0d2VlbjpDYW5jZWwoKQplbmQKCnJldHVybiB0d2VlbmZ1bmMKZW5kCgpmdW5jdGlvbiBUUFAoQ0ZnbykKCWlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpLkhlYWx0aCA8PSAwIG9yIG5vdCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpIHRoZW4gdHdlZW46Q2FuY2VsKCkgcmVwZWF0IHdhaXQoKSB1bnRpbCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpIGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpLkhlYWx0aCA+IDAgd2FpdCg3KSByZXR1cm4gZW5kCglsb2NhbCB0d2Vlbl9zID0gZ2FtZTpzZXJ2aWNlIlR3ZWVuU2VydmljZSIKCWxvY2FsIGluZm8gPSBUd2VlbkluZm8ubmV3KChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKVsiTG9jYWxQbGF5ZXIiXS5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIENGZ28uUG9zaXRpb24pLk1hZ25pdHVkZS8zMjUsIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyKQoJdHdlZW4gPSB0d2Vlbl9zOkNyZWF0ZShnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyWyJIdW1hbm9pZFJvb3RQYXJ0Il0sIGluZm8sIHtDRnJhbWUgPSBDRmdvfSkKCXR3ZWVuOlBsYXkoKQoKCWxvY2FsIHR3ZWVuZnVuYyA9IHt9CgoJZnVuY3Rpb24gdHdlZW5mdW5jOlN0b3AoKQoJCXR3ZWVuOkNhbmNlbCgpCgllbmQKCglyZXR1cm4gdHdlZW5mdW5jCmVuZAoKZnVuY3Rpb24gRXF1aXBXZWFwb25Td29yZCgpCglwY2FsbChmdW5jdGlvbigpCgkJZm9yIGksdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJaWYgdi5Ub29sVGlwID09ICJTd29yZCIgYW5kIHY6SXNBKCdUb29sJykgdGhlbgoJCQkJbG9jYWwgVG9vbEh1bWFub2lkID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHYuTmFtZSkgCgkJCQlnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChUb29sSHVtYW5vaWQpIAoJCQllbmQKCQllbmQKCWVuZCkKZW5kCgpmdW5jdGlvbiBFcXVpcFdlYXBvbkd1bigpCglwY2FsbChmdW5jdGlvbigpCgkJZm9yIGksdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJaWYgdi5Ub29sVGlwID09ICJHdW4iIGFuZCB2OklzQSgnVG9vbCcpIHRoZW4KCQkJCWxvY2FsIFRvb2xIdW1hbm9pZCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCh2Lk5hbWUpIAoJCQkJZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woVG9vbEh1bWFub2lkKSAKCQkJZW5kCgkJZW5kCgllbmQpCmVuZAoKZ2V0Z2VudigpLlRvVGFyZ2V0cyA9IGZ1bmN0aW9uKHApCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyOkRpc3RhbmNlRnJvbUNoYXJhY3RlcihwLlBvc2l0aW9uKSA8PSAyNTAgdGhlbiAKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHAKICAgICAgICAgICAgZWxzZWlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSb290Iil0aGVuIAogICAgICAgICAgICAgICAgbG9jYWwgSyA9IEluc3RhbmNlLm5ldygiUGFydCIsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcikKICAgICAgICAgICAgICAgIEsuU2l6ZSA9IFZlY3RvcjMubmV3KDEsMC41LDEpCiAgICAgICAgICAgICAgICBLLk5hbWUgPSAiUm9vdCIKICAgICAgICAgICAgICAgIEsuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBLLlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIEsuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICBLLkNGcmFtZSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsMjAsMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGxvY2FsIFUgPSAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uLXAuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICBsb2NhbCB6ID0gZ2FtZTpzZXJ2aWNlKCJUd2VlblNlcnZpY2UiKQogICAgICAgICAgICBsb2NhbCBCID0gVHdlZW5JbmZvLm5ldygocC5Qb3NpdGlvbi1nYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJvb3QuUG9zaXRpb24pLk1hZ25pdHVkZS8zMDAsRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpCiAgICAgICAgICAgIGxvY2FsIFMsZyA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgcSA9IHo6Q3JlYXRlKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUm9vdCxCLHtDRnJhbWUgPSBwfSkKICAgICAgICAgICAgcTpQbGF5KCkKICAgICAgICBlbmQpCiAgICAgICAgaWYgbm90IFMgdGhlbiAKICAgICAgICAgICAgcmV0dXJuIGcKICAgICAgICBlbmQKICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJvb3QuQ0ZyYW1lID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICBpZiBTIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSb290IikgdGhlbiAKICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uLXAuUG9zaXRpb24pLk1hZ25pdHVkZSA+PSAyMCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUm9vdC5Qb3NpdGlvbi1nYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDE1MCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJvb3QuQ0ZyYW1lID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWU9Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5Sb290LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24tcC5Qb3NpdGlvbikuTWFnbml0dWRlID49IDEwIGFuZChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24tcC5Qb3NpdGlvbikuTWFnbml0dWRlIDwgMjAgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHAKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbi1wLlBvc2l0aW9uKS5NYWduaXR1ZGUgPCAxMCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gcAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKCSAgICBlbmQpCiAgICBlbmQpCiAgICBlbmQKCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgICAgIGlmIF9HLkF1dG9fQm9uZTIgb3IgX0cuTGlvbkZpeERyaXZlIG9yIF9HLk5lY2hpZXUgb3IgX0cuQXV0b0Zhcm1Cb3NzSGFsbG93IG9yIF9HLkF1dG9fQm9uZTIgb3IgT3ZlciBvciBPdmVyMiBvciBSdW4gb3IgUnVuMiBvciBfRy5BdXRvS2F0YSBvciBfRy5BdXRvTGV2ZWwyIG9yIF9HLkF1dG9GYXJtTmVhcmVzdCBvciBfRy5BdXRvQm9zcyBvciBfRy5GYXJtZmFzdCBvciBfRy5Ud2VlbmZydWl0IG9yIF9HLkF1dG9fRHVuZ2VvbiBvciBfRy5LaWxsX1Y0IG9yIF9HLmtpbGxub3NraWxsIG9yIF9HLkF1dG9RdWVzdFJhY2Ugb3IgX0cuUmFEYW9LaGkgb3IgX0cuTHVvbV9HZWFyIG9yIF9HLkRhb0JpTG9uIG9yIF9HLkF1dG9TZWNvbmRTZWEgb3IgX0cuQXV0b19Fdm9SYWNlIG9yIF9HLkF1dG9fRHJhZ29uX1RyaWRlbnQgb3IgX0cuQXV0b19LaWxsX1BseSBvciBfRy5UZWxlcG9ydCBvciBfRy5FbGlfTmd1IG9yIF9HLkNodWF0ZV9CYWNfR2lhbmcgb3IgX0cuQXV0b0NhcnZlbmRlciBvciBfRy5EaV9uZ2hpYV92dV9xdWFuX3N1IG9yIF9HLkF1dG9FY3RvcGxhc20gb3IgX0cuS2llbV9MdWEgb3IgQXV0b19LaV9EaSBvciBfRy5BdXRvUG9sZSBvciBfRy5BdXRvUGxheWVySHVudGVyIG9yIF9HLkF1dG9NYXRlcmlhbCBvciBfRy5BdXRvX1NhYmVyIG9yIF9HLlR3ZWVuVG9LaXRzdW5lIG9yIF9HLkF1dG9fTmhhX0RpZW4gb3IgX0cuVGVsZXBvcnROUEMgb3IgX0cuQXV0b0RhcmtEYWdnZXIgb3IgX0cuQ2hvbkhha2kgb3IgX0cuUmFpZFBpcmF0ZSBvciBfRy5BdXRvT2JzZXJ2YXRpb24gb3IgX0cuQXV0b0Zhcm0gb3IgX0cuQXV0b0hha2lWMiBvciBfRy5Db2xsZWN0QXp1cmUgb3IgX0cuQ2l0aXplblF1ZXN0IG9yIF9HLlRlbGVwb3J0SXNsYW5kIG9yIF9HLlRlbGVwb3J0UGx5IG9yIF9HLkxpb25BdXRvRHJpdmVCb2F0IG9yIF9HLkZhcm1Cb25lQWNpZW50IG9yIF9HLkF1dG9GYXJtRnJ1aXRNYXN0ZXJ5IG9yIF9HLkF1dG9GYXJtR3VuTWFzdGVyeSBvciBfRy5BdXRvU3dvcmRNYXN0ZXJ5IG9yIF9HLkF1dG9DYW1lIG9yIF9HLmF1dG9MYXdSYWlkIG9yIF9HLkF1dG9fU2VhYmVzdCBvciBfRy5BdXRvVGVycm9yc2hhcmsgb3IgRmFybVNoYXJrIG9yIF9HLmZhcm1waXJhbnlhIG9yIF9HLkZpc2hfQ3Jld19NZW1iZXIgb3IgX0cuQXV0b1NoaXAgb3IgX0cuYmppckZpc2hCb2F0IG9yIF9HLmJqaXJGaXNoQm9hdCBvciBfRy5BdXRvU2VhQmVzdCBvciBfRy5Ud2VlbkZybyBvciBHcmFiX0NoZXN0MSBvciBHcmFiX0NoZXN0MiBvciBfRy5BdXRvRmFybUJvc3MgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0OkZpbmRGaXJzdENoaWxkKCJCb2R5Q2xpcCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgTm9jbGlwID0gSW5zdGFuY2UubmV3KCJCb2R5VmVsb2NpdHkiKQogICAgICAgICAgICAgICAgICAgICAgICBOb2NsaXAuTmFtZSA9ICJCb2R5Q2xpcCIKICAgICAgICAgICAgICAgICAgICAgICAgTm9jbGlwLlBhcmVudCA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgICAgICAgICAgICAgICAgIE5vY2xpcC5NYXhGb3JjZSA9IFZlY3RvcjMubmV3KDEwMDAwMCwxMDAwMDAsMTAwMDAwKQogICAgICAgICAgICAgICAgICAgICAgICBOb2NsaXAuVmVsb2NpdHkgPSBWZWN0b3IzLm5ldygwLDAsMCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQpCiAgCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5TdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgX0cuQXV0b19Cb25lMiBvciBfRy5MaW9uRml4RHJpdmUgb3IgX0cuTmVjaGlldSBvciBfRy5BdXRvRmFybUJvc3NIYWxsb3cgb3IgT3ZlciBvciBPdmVyMiBvciBSdW4gb3IgUnVuMiBvciBfRy5BdXRvS2F0YSBvciBfRy5BdXRvTGV2ZWwyIG9yIF9HLkF1dG9Cb3NzIG9yIF9HLkZhcm1mYXN0IG9yIF9HLlR3ZWVuZnJ1aXQgb3IgX0cuQXV0b19EdW5nZW9uIG9yIF9HLktpbGxfVjQgb3IgX0cua2lsbG5vc2tpbGwgb3IgX0cuQXV0b1F1ZXN0UmFjZSBvciBfRy5SYURhb0toaSBvciBfRy5MdW9tX0dlYXIgb3IgX0cuRGFvQmlMb24gb3IgX0cuQXV0b1NlY29uZFNlYSBvciBfRy5BdXRvX0V2b1JhY2Ugb3IgX0cuQXV0b19EcmFnb25fVHJpZGVudCBvciBfRy5CYXlEYW8gb3IgX0cuRWxpX05ndSBvciBfRy5DaHVhdGVfQmFjX0dpYW5nIG9yIF9HLkF1dG9DYXJ2ZW5kZXIgb3IgX0cuRGlfbmdoaWFfdnVfcXVhbl9zdSBvciBfRy5BdXRvRWN0b3BsYXNtIG9yIF9HLktpZW1fTHVhIG9yIEF1dG9fS2lfRGkgb3IgX0cuS2hpX0RvdF9MZW5fRGllbiBvciBfRy5BdXRvUGxheWVySHVudGVyIG9yIF9HLkZhcm1Cb25lQWNpZW50IG9yIF9HLkF1dG9GYXJtRnJ1aXRNYXN0ZXJ5IG9yIF9HLkF1dG9GYXJtR3VuTWFzdGVyeSBvciBfRy5BdXRvU3dvcmRNYXN0ZXJ5IG9yIF9HLlR3ZWVuVG9LaXRzdW5lIG9yIF9HLkF1dG9fTmhhX0RpZW4gb3IgX0cuQXV0b01hdGVyaWFsIG9yIF9HLlRlbGVwb3J0TlBDIG9yIF9HLkF1dG9EYXJrRGFnZ2VyIG9yIF9HLkF1dG9GYXJtIG9yIF9HLkNob25IYWtpIG9yIF9HLlJhaWRQaXJhdGUgb3IgX0cuQXV0b09ic2VydmF0aW9uIG9yIF9HLkF1dG9IYWtpVjIgb3IgX0cuQ29sbGVjdEF6dXJlIG9yIF9HLkNpdGl6ZW5RdWVzdCBvciBfRy5UZWxlcG9ydElzbGFuZCBvciBfRy5UZWxlcG9ydFBseSBvciBfRy5DYWNSYWNlIG9yIF9HLkxpb25BdXRvRHJpdmVCb2F0IG9yIF9HLkxpb25BdXRvRHJpdmVCb2F0MiBvciBfRy5BdXRvVGVycm9yc2hhcmsgb3IgRmFybVNoYXJrIG9yIF9HLmZhcm1waXJhbnlhIG9yIF9HLkZpc2hfQ3Jld19NZW1iZXIgb3IgX0cuQXV0b1NoaXAgb3IgX0cuQXV0b1NlYUJlc3Qgb3IgX0cuYXV0b0xhd1JhaWQgb3IgX0cuQXV0b19TZWFiZXN0IG9yIF9HLkJ1b2kgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJCYXNlUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuQ2FuQ29sbGlkZSA9IGZhbHNlICAgIAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kKQogICAgZW5kKSAgIAogICAgCmZ1bmN0aW9uIENsaWNrKCkKICAgICAgICBpZiBub3QgX0cuRmFzdEF0dGFjayB0aGVuCiAgICAgICAgICAgIGxvY2FsIE1vZHVsZSA9IHJlcXVpcmUoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLlBsYXllclNjcmlwdHMuQ29tYmF0RnJhbWV3b3JrKQogICAgICAgICAgICBsb2NhbCBDb21iYXRGcmFtZXdvcmsgPSBkZWJ1Zy5nZXR1cHZhbHVlcyhNb2R1bGUpWzJdCiAgICAgICAgICAgIGxvY2FsIENhTW9iTmFtZWhha2UgPSByZXF1aXJlKGdhbWUuUmVwbGljYXRlZFN0b3JhZ2UuVXRpbC5DYW1lcmFTaGFrZXIpCiAgICAgICAgICAgIENhTW9iTmFtZWhha2U6U3RvcCgpCiAgICAgICAgICAgIENvbWJhdEZyYW1ld29yay5hY3RpdmVDb250cm9sbGVyLmF0dGFja2luZyA9IGZhbHNlCiAgICAgICAgICAgIENvbWJhdEZyYW1ld29yay5hY3RpdmVDb250cm9sbGVyLnRpbWVUb05leHRBdHRhY2sgPSAwCiAgICAgICAgICAgIENvbWJhdEZyYW1ld29yay5hY3RpdmVDb250cm9sbGVyLmhpdGJveE1hZ25pdHVkZSA9IDE4MAogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UgJ1ZpcnR1YWxVc2VyJzpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsIDY3MikpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIApzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgIGlmIE92ZXIgb3IgX0cuQXV0b19Cb25lMiBvciBfRy5LaWxsX1Y0IG9yIF9HLmtpbGxub3NraWxsIG9yIF9HLkF1dG9fS2lsbF9QbHkgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUU6RmlyZVNlcnZlcigiS2VuIix0cnVlKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQgICAgCiAgICAgICAgZW5kCiAgICBlbmQpICAgIAogICAgCiAgICBmdW5jdGlvbiBJbnN0YW5jZVBvcyhwb3MpCiAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHBvcwogICAgZW5kICAgIAogICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8gIAogICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJSZW1vdGVGdW5jdGlvblNob290IikgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdFdlYXBvbkd1biA9IHYuTmFtZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQpCiAgICAKICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLklkbGVkOmNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpCdXR0b24yRG93bihWZWN0b3IyLm5ldygwLDApLHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZSkKICAgICAgICB3YWl0KDEpCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkJ1dHRvbjJVcChWZWN0b3IyLm5ldygwLDApLHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZSkKICAgIGVuZCkgCgpsb2NhbCBQbGF5ZXJOYW1lID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkRpc3BsYXlOYW1lCnJlcXVpcmUoZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5Ob3RpZmljYXRpb24pLm5ldygiPENvbG9yPUJsdWU+IiAuLlBsYXllck5hbWUuLiAiPENvbG9yPS8+Iik6RGlzcGxheSgpCgoKCnNldGZwc2NhcCg2MCkKCmxvY2FsIE1pbmhEZXBaYWkgPSBDRnJhbWUubmV3KC05NTA2LjIzNDM3NSwgMTcyLjEzMDYxNTIzNDM3NSwgNjExNy4wNzcxNDg0Mzc1KQpsb2NhbCBDYWtlUG9zID0gQ0ZyYW1lLm5ldygtMTk3OC40NTcxNSwgMjUxLjUzNTI5NCwgLTEyMzk1LjI5NzkpCmxvY2FsIEphY2tCb0NvbiA9IENGcmFtZS5uZXcoLTc3NDguMDE4NTU0Njg3NSwgNTYwNi44MDYxNTIzNDM3NSwgLTIzMDUuODk4NjgxNjQwNjI1KQpsb2NhbCBEb21kb20gPSBDRnJhbWUubmV3KC01MzQ0LjgyMjI2NTYyNSwgNDIzLjk4NTQxMjU5NzY2LCAtMjcyNS4wOTMwMTc1NzgxKQpsb2NhbCBMb25nTWEgPSBDRnJhbWUubmV3KC0xMDIzOC44NzU5NzY1NjMsIDM4OS43OTEyOTAyODMyLCAtOTU0OS43OTM5NDUzMTI1KQpsb2NhbCBNdWFUaCA9IENGcmFtZS5uZXcoLTE2OTI3LjQ1MTE3MTg3NSwgOS4wODYzNjE4ODUwNzA4LCA0MzMuODY0Mjg4MzMwMDc4MSkKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBwbGF5ZXJDb3VudCA9ICNnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKTpHZXRQbGF5ZXJzKCkKCmxvY2FsIHBsYWNlSWQgPSBnYW1lLlBsYWNlSWQKbG9jYWwgam9iSWQgPSBnYW1lLkpvYklkCgpsb2NhbCBDaGVja0x1T2NDaG8gPSAjZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIik6R2V0UGxheWVycygpCgpfRy5CcmluZ01vZGUgPSAzMDAKUG9zWSA9IDQ1CkF1dG9IYWtpKCkKCnNwYXduKGZ1bmN0aW9uKCkKCWZ1bmN0aW9uIE1pbmhEZXBaYWkoKQoJCWdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpDYXB0dXJlQ29udHJvbGxlcigpCgkJZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsIDY3MikpCgllbmQKZW5kKQoKZnVuY3Rpb24gU3RvcFR3ZWVuKHRhcmdldCkKICAgICAgICBpZiBub3QgdGFyZ2V0IHRoZW4KICAgICAgICBfRy5TdG9wVHdlZW4gPSB0cnVlCiAgICAgICAgd2FpdCgpCiAgICAgICAgdG9wb3MoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lKQogICAgICAgIHdhaXQoKQogICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0OkZpbmRGaXJzdENoaWxkKCJCb2R5Q2xpcCIpIHRoZW4KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydDpGaW5kRmlyc3RDaGlsZCgiQm9keUNsaXAiKTpEZXN0cm95KCkKICAgICAgICBlbmQKICAgICAgICBfRy5TdG9wVHdlZW4gPSBmYWxzZQogICAgICAgIF9HLkNsaXAgPSBmYWxzZQogICAgICAgIGVuZAogICAgICAgIGVuZAoKZnVuY3Rpb24gR2V0RGlzdGFuY2UocSkKICAgIGlmIHR5cGUocSkgPT0gImluc3RhbmNlIiB0aGVuCiAgICAgICAgaWYgSW5zdGFuY2U6SXNBKCJCYXNlUGFydCIpIG9yIEluc3RhbmNlOklzQSgiUGFydCIpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIChxLlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICBlbHNlaWYgSW5zdGFuY2U6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgIHJldHVybiAocS5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZvciByLCB2IGluIHBhaXJzKHE6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJCYXNlUGFydCIpIG9yIHY6SXNBKCJQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiAodi5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIChxIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgIGVuZAplbmQKCmZ1bmN0aW9uIEluTXlOZXRXb3JrKG9iamVjdCkKCWlmIGlzbmV0d29ya293bmVyIHRoZW4KCQlyZXR1cm4gaXNuZXR3b3Jrb3duZXIob2JqZWN0KQoJZWxzZQoJCWlmIChvYmplY3QuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSBfRy5CcmluZ01vZGUgdGhlbiAKCQkJcmV0dXJuIHRydWUKCQllbmQKCQlyZXR1cm4gZmFsc2UKCWVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIHJvdW5kKG51bSkKICAgIHJldHVybiBtYXRoLmZsb29yKG51bSArIDAuNSkKZW5kCgpmdW5jdGlvbiBVcGRhdGVEZXZpbENoYW1zKCkKICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBEZXZpbEZydWl0RVNQIHRoZW4KICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKHYuTmFtZSwgIkZydWl0IikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkhhbmRsZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBoYW5kbGUgPSB2LkhhbmRsZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVzcE5hbWUgPSAnTmFtZUVzcCcgLi4gTnVtYmVyCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGhhbmRsZTpGaW5kRmlyc3RDaGlsZChlc3BOYW1lKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJpbGwgPSBJbnN0YW5jZS5uZXcoJ0JpbGxib2FyZEd1aScsIGhhbmRsZSkKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbC5OYW1lID0gZXNwTmFtZQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLkV4dGVudHNPZmZzZXQgPSBWZWN0b3IzLm5ldygwLCAxLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLlNpemUgPSBVRGltMi5uZXcoMSwgMjAwLCAxLCAzMCkKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbC5BZG9ybmVlID0gaGFuZGxlCiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGwuQWx3YXlzT25Ub3AgPSB0cnVlCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBuYW1lID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnLCBiaWxsKQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtU2VtaWJvbGQKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0U2l6ZSA9IDE0IAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHRXcmFwcGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0WUFsaWdubWVudCA9IEVudW0uVGV4dFlBbGlnbm1lbnQuVG9wCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0U3Ryb2tlVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuVGV4dCA9IHN0cmluZy5mb3JtYXQoIiVzXG4lZCBEaXN0YW5jZSIsIHYuTmFtZSwgcm91bmQoKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkLlBvc2l0aW9uIC0gaGFuZGxlLlBvc2l0aW9uKS5NYWduaXR1ZGUgLyAzKSkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBoYW5kbGVbZXNwTmFtZV0uVGV4dExhYmVsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuVGV4dCA9IHN0cmluZy5mb3JtYXQoIiVzXG4lZCBEaXN0YW5jZSIsIHYuTmFtZSwgcm91bmQoKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkLlBvc2l0aW9uIC0gaGFuZGxlLlBvc2l0aW9uKS5NYWduaXR1ZGUgLyAzKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIYW5kbGUiKSBhbmQgdi5IYW5kbGU6RmluZEZpcnN0Q2hpbGQoJ05hbWVFc3AnIC4uIE51bWJlcikgdGhlbgogICAgICAgICAgICAgICAgICAgIHYuSGFuZGxlWydOYW1lRXNwJyAuLiBOdW1iZXJdOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgaWYgX0cuVHdlZW5mcnVpdCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIGFuZCBzdHJpbmcuZmluZCh2Lk5hbWUsICJGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsdjpHZXRBdHRyaWJ1dGUoIk9yaWdpbmFsTmFtZSIpLHYpCiAgICAgICAgICAgICAgICAgICAgICAgIExvYWQuVGV4dCA9ICJLZWVwIEZydWl0IFN1Y2Nlc3MiCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIGFuZCBzdHJpbmcuZmluZCh2Lk5hbWUsICJGcnVpdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RvcmVGcnVpdCIsdjpHZXRBdHRyaWJ1dGUoIk9yaWdpbmFsTmFtZSIpLHYpCiAgICAgICAgICAgICAgICAgICAgICAgIExvYWQuVGV4dCA9ICJLZWVwIEZydWl0IFN1Y2Nlc3MiCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmZ1bmN0aW9uIEhvcCgpCiAgICBsb2NhbCBQbGFjZUlEID0gZ2FtZS5QbGFjZUlkCiAgICBsb2NhbCBKb2JJRCA9IGdhbWUuSm9iSWQKICAgIGxvY2FsIEFsbElEcyA9IHt9CiAgICBsb2NhbCBDdXJzb3IgPSAiIgogICAgbG9jYWwgSG91ciA9IG9zLmRhdGUoIiEqdCIpLmhvdXIKICAgIAogICAgbG9jYWwgZnVuY3Rpb24gU2F2ZUlEcygpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICB3cml0ZWZpbGUoIk5vdFNhbWVTZXJ2ZXJzLmpzb24iLCBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIik6SlNPTkVuY29kZShBbGxJRHMpKQogICAgICAgIGVuZCkKICAgIGVuZAogICAgbG9jYWwgZnVuY3Rpb24gTG9hZElEcygpCiAgICAgICAgbG9jYWwgc3VjY2VzcywgZGF0YSA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIHJlYWRmaWxlKCJOb3RTYW1lU2VydmVycy5qc29uIikKICAgICAgICBlbmQpCiAgICAgICAgaWYgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgIEFsbElEcyA9IGdhbWU6R2V0U2VydmljZSgiSHR0cFNlcnZpY2UiKTpKU09ORGVjb2RlKGRhdGEpCiAgICAgICAgZWxzZQogICAgICAgICAgICBBbGxJRHMgPSB7SG91cn0KICAgICAgICAgICAgU2F2ZUlEcygpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGxvY2FsIGZ1bmN0aW9uIENoZWNrRm9yRnJ1aXQoKQogICAgICAgIGxvY2FsIGhhc0ZydWl0ID0gZmFsc2UKICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2U6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgaWYgdjpJc0EoIk1vZGVsIikgYW5kIHYuTmFtZTpsb3dlcigpOmZpbmQoImZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgaGFzRnJ1aXQgPSB0cnVlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gaGFzRnJ1aXQKICAgIGVuZAogICAgbG9jYWwgZnVuY3Rpb24gVFBSZXR1cm5lcigpCiAgICAgICAgbG9jYWwgU2l0ZQogICAgICAgIGlmIEN1cnNvciA9PSAiIiB0aGVuCiAgICAgICAgICAgIFNpdGUgPSBnYW1lLkh0dHBTZXJ2aWNlOkpTT05EZWNvZGUoZ2FtZTpIdHRwR2V0KCdodHRwczovL2dhbWVzLnJvYmxveC5jb20vdjEvZ2FtZXMvJyAuLiBQbGFjZUlEIC4uICcvc2VydmVycy9QdWJsaWM/c29ydE9yZGVyPUFzYyZsaW1pdD0xMDAnKSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIFNpdGUgPSBnYW1lLkh0dHBTZXJ2aWNlOkpTT05EZWNvZGUoZ2FtZTpIdHRwR2V0KCdodHRwczovL2dhbWVzLnJvYmxveC5jb20vdjEvZ2FtZXMvJyAuLiBQbGFjZUlEIC4uICcvc2VydmVycy9QdWJsaWM/c29ydE9yZGVyPUFzYyZsaW1pdD0xMDAmY3Vyc29yPScgLi4gQ3Vyc29yKSkKICAgICAgICBlbmQKICAgICAgICBpZiBTaXRlLm5leHRQYWdlQ3Vyc29yIHRoZW4KICAgICAgICAgICAgQ3Vyc29yID0gU2l0ZS5uZXh0UGFnZUN1cnNvcgogICAgICAgIGVuZAogICAgICAgIGZvciBfLCB2IGluIHBhaXJzKFNpdGUuZGF0YSkgZG8KICAgICAgICAgICAgbG9jYWwgSUQgPSB0b3N0cmluZyh2LmlkKQogICAgICAgICAgICBpZiB0b251bWJlcih2Lm1heFBsYXllcnMpID4gdG9udW1iZXIodi5wbGF5aW5nKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBhbHJlYWR5VmlzaXRlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICBmb3IgXywgZXhpc3RpbmcgaW4gcGFpcnMoQWxsSURzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIElEID09IGV4aXN0aW5nIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgYWxyZWFkeVZpc2l0ZWQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBub3QgYWxyZWFkeVZpc2l0ZWQgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChBbGxJRHMsIElEKQogICAgICAgICAgICAgICAgICAgIFNhdmVJRHMoKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIik6VGVsZXBvcnRUb1BsYWNlSW5zdGFuY2UoUGxhY2VJRCwgSUQsIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcikKICAgICAgICAgICAgICAgICAgICB3YWl0KDUpIAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIENoZWNrRm9yRnJ1aXQoKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJGcnVpdCBmb3VuZCBpbiBzZXJ2ZXI6IiwgSUQpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiTm8gZnJ1aXQgZm91bmQsIHNlYXJjaGluZyBuZXh0IHNlcnZlci4iKQogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUoQWxsSURzLCAjQWxsSURzKSAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIFRlbGVwb3J0TG9vcCgpCiAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgIHBjYWxsKFRQUmV0dXJuZXIpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIExvYWRJRHMoKQogICAgVGVsZXBvcnRMb29wKCkKZW5kCgogICAgCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoLjEpIGRvCiAgICAgICAgaWYgX0cuVHdlZW5mcnVpdCB0aGVuCiAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZS5Xb3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKHYuTmFtZSwgIkZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgVXBkYXRlRGV2aWxDaGFtcygpCiAgICAgICAgICAgICAgICAgICAgdG9wb3Modi5IYW5kbGUuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB3YWl0KDYpCiAgICAgICAgICAgICAgICAgICAgSG9wKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpzcGF3bihmdW5jdGlvbigpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSB3YWl0KC4xKSBkbwogICAgICAgICAgICAgICAgaWYgX0cuVHdlZW5mcnVpdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQ291c2luIiwiQnV5IikKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kKQogICAgCnNwYXduKGZ1bmN0aW9uKCkKCXdoaWxlIHdhaXQoKSBkbwoJCWlmIFJlam9pbl9Cb29zdCB0aGVuCgkJCQlnZXRnZW52KCkucmVqb2luID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuUm9ibG94UHJvbXB0R3VpLnByb21wdE92ZXJsYXkuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQoJCQkJCWlmIGNoaWxkLk5hbWUgPT0gJ0Vycm9yUHJvbXB0JyBhbmQgY2hpbGQ6RmluZEZpcnN0Q2hpbGQoJ01lc3NhZ2VBcmVhJykgYW5kIGNoaWxkLk1lc3NhZ2VBcmVhOkZpbmRGaXJzdENoaWxkKCJFcnJvckZyYW1lIikgdGhlbgoJCQkJCQlnYW1lOkdldFNlcnZpY2UoIlRlbGVwb3J0U2VydmljZSIpOlRlbGVwb3J0KGdhbWUuUGxhY2VJZCkKCQkJCQllbmQKCQkJCSBlbmQpCgkJCWVuZAoJCWVuZAoJZW5kKQoJCnNwYXduKGZ1bmN0aW9uKCkKCXdoaWxlIHdhaXQoKSBkbwoJCWlmIFJlam9pbl9Cb29zdCB0aGVuCgkJCXBjYWxsKGZ1bmN0aW9uKCkKCQkJCWdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5Ob3RpZmljYXRpb25zLkVuYWJsZWQgPSBmYWxzZQoJCQkJCgkJCQlzaGFyZWQgPSB7fQoJCQkJc2hhcmVkLkJDXzEgPSB0cnVlCgkJCQlzaGFyZWQuQkNfMiA9IG5pbAoKCQkJCWlmIHNoYXJlZC5CQ18xIGFuZCBzaGFyZWQuQkNfMiA9PSBuaWwgdGhlbgoJCQkJCWxvY2FsIFdvcmtzcGFjZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikKCQkJCQlsb2NhbCBMaWdodGluZyA9IGdhbWU6R2V0U2VydmljZSgiTGlnaHRpbmciKQoJCQkJCWxvY2FsIFRlcnJhaW4gPSBXb3Jrc3BhY2UuVGVycmFpbgoJCQkJCWxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQoJCQkJCWxvY2FsIENoYXJhY3RlciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIFBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgoJCQkJCVRlcnJhaW4uV2F0ZXJXYXZlU2l6ZSA9IDAKCQkJCQlUZXJyYWluLldhdGVyV2F2ZVNwZWVkID0gMAoJCQkJCVRlcnJhaW4uV2F0ZXJSZWZsZWN0YW5jZSA9IDAKCQkJCQlUZXJyYWluLldhdGVyVHJhbnNwYXJlbmN5ID0gMAoKCQkJCQlMaWdodGluZy5HbG9iYWxTaGFkb3dzID0gZmFsc2UKCQkJCQlMaWdodGluZy5Gb2dFbmQgPSBtYXRoLmh1Z2UKCQkJCQlMaWdodGluZy5CcmlnaHRuZXNzID0gMAoKCQkJCQlzZXR0aW5ncygpLlJlbmRlcmluZy5RdWFsaXR5TGV2ZWwgPSBFbnVtLlF1YWxpdHlMZXZlbC5MZXZlbDAxCgkJCQkJc2V0dGluZ3MoKS5SZW5kZXJpbmcuR3JhcGhpY3NNb2RlID0gRW51bS5HcmFwaGljc01vZGUuTm9HcmFwaGljcwoKCQkJCQlmb3IgXywgdiBpbiBwYWlycyhXb3Jrc3BhY2U6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCQkJaWYgdjpJc0EoIkJhc2VQYXJ0IikgdGhlbgoJCQkJCQkJdi5NYXRlcmlhbCA9IEVudW0uTWF0ZXJpYWwuUGxhc3RpYwoJCQkJCQkJdi5SZWZsZWN0YW5jZSA9IDAKCQkJCQkJCXYuQ2FzdFNoYWRvdyA9IGZhbHNlCgkJCQkJCWVsc2VpZiB2OklzQSgiRGVjYWwiKSBvciB2OklzQSgiVGV4dHVyZSIpIHRoZW4KCQkJCQkJCXYuVGV4dHVyZSA9ICIiCgkJCQkJCQl2LlRyYW5zcGFyZW5jeSA9IDEKCQkJCQkJZWxzZWlmIHY6SXNBKCJQYXJ0aWNsZUVtaXR0ZXIiKSBvciB2OklzQSgiVHJhaWwiKSB0aGVuCgkJCQkJCQl2LkxpZ2h0SW5mbHVlbmNlID0gMAoJCQkJCQkJdi5UZXh0dXJlID0gIiIKCQkJCQkJCXYuTGlmZXRpbWUgPSBOdW1iZXJSYW5nZS5uZXcoMCkKCQkJCQkJZWxzZWlmIHY6SXNBKCJFeHBsb3Npb24iKSB0aGVuCgkJCQkJCQl2LkJsYXN0UHJlc3N1cmUgPSAwCgkJCQkJCQl2LkJsYXN0UmFkaXVzID0gMAoJCQkJCQllbHNlaWYgdjpJc0EoIkZpcmUiKSBvciB2OklzQSgiU3BvdExpZ2h0Iikgb3IgdjpJc0EoIlNtb2tlIikgb3IgdjpJc0EoIlNwYXJrbGVzIikgdGhlbgoJCQkJCQkJdi5FbmFibGVkID0gZmFsc2UKCQkJCQkJZWxzZWlmIHY6SXNBKCJNZXNoUGFydCIpIHRoZW4KCQkJCQkJCXYuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsLlBsYXN0aWMKCQkJCQkJCXYuUmVmbGVjdGFuY2UgPSAwCgkJCQkJCQl2LlRleHR1cmVJRCA9ICIiCgkJCQkJCQl2LkNhc3RTaGFkb3cgPSBmYWxzZQoJCQkJCQkJdi5SZW5kZXJGaWRlbGl0eSA9IEVudW0uUmVuZGVyRmlkZWxpdHkuUGVyZm9ybWFuY2UKCQkJCQkJZWxzZWlmIHY6SXNBKCJTcGVjaWFsTWVzaCIpIHRoZW4KCQkJCQkJCXYuVGV4dHVyZUlEID0gIiIKCQkJCQkJZWxzZWlmIHY6SXNBKCJTaGlydCIpIG9yIHY6SXNBKCJQYW50cyIpIG9yIHY6SXNBKCJBY2Nlc3NvcnkiKSB0aGVuCgkJCQkJCQl2OkRlc3Ryb3koKQoJCQkJCQllbmQKCQkJCQllbmQKCgkJCQkJZm9yIF8sIHYgaW4gcGFpcnMoTGlnaHRpbmc6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCQkJaWYgdjpJc0EoIkJsdXJFZmZlY3QiKSBvciB2OklzQSgiU3VuUmF5c0VmZmVjdCIpIG9yIHY6SXNBKCJDb2xvckNvcnJlY3Rpb25FZmZlY3QiKSBvciB2OklzQSgiQmxvb21FZmZlY3QiKSBvciB2OklzQSgiRGVwdGhPZkZpZWxkRWZmZWN0IikgdGhlbgoJCQkJCQkJdi5FbmFibGVkID0gZmFsc2UKCQkJCQkJZW5kCgkJCQkJZW5kCgoJCQkJCWZvciBfLCB2IGluIHBhaXJzKENoYXJhY3RlcjpHZXREZXNjZW5kYW50cygpKSBkbwoJCQkJCQlpZiB2OklzQSgiU2hpcnQiKSBvciB2OklzQSgiUGFudHMiKSBvciB2OklzQSgiQWNjZXNzb3J5IikgdGhlbgoJCQkJCQkJdjpEZXN0cm95KCkKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kKQoJCWVuZAoJZW5kCmVuZCkKCgpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgIGlmIF9HLlRlbGVNaXJhZ2UgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXA6RmluZEZpcnN0Q2hpbGQoIk15c3RpY0lzbGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KAogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5NeXN0aWNJc2xhbmQuQ2VudGVyLlBvc2l0aW9uLlgsCiAgICAgICAgICAgICAgICAgICAgICAgIDUwMCwKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuTXlzdGljSXNsYW5kLkNlbnRlci5Qb3NpdGlvbi5aCiAgICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25MaWJyYXJ5OlNlbmROb3RpZmljYXRpb24oIldhcm5pbmciLCAiVHdlZW4gTWlyYWdlIElzbGFuZDogT24iLCAxMCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuTW9vbiB0aGVuCiAgICAgICAgICAgICAgICB3YWl0KDAuNSkKICAgICAgICAgICAgICAgIGxvY2FsIG1vb25EaXIgPSBnYW1lLkxpZ2h0aW5nOkdldE1vb25EaXJlY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgbG9va0F0UG9zID0gZ2FtZS5Xb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUucCArIG1vb25EaXIgKiAxMDAKICAgICAgICAgICAgICAgIGdhbWUuV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lID0gQ0ZyYW1lLmxvb2tBdChnYW1lLldvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5wLCBsb29rQXRQb3MpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgoKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICBpZiBfRy5WMyB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRTpGaXJlU2VydmVyKCJBY3RpdmF0ZUFiaWxpdHkiKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgaWYgX0cuTHVvbV9HZWFyIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwOkZpbmRGaXJzdENoaWxkKCJNeXN0aWNJc2xhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuTXlzdGljSXNsYW5kOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJNZXNoUGFydCIpIGFuZCB2Lk1hdGVyaWFsID09IEVudW0uTWF0ZXJpYWwuTmVvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCgpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgIGlmIF9HLlB1bGxMZXZlciB0aGVuCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcDpGaW5kRmlyc3RDaGlsZCgiTXlzdGljSXNsYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgIF9HLlNwZWFrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIF9HLlR3ZWVuZnJ1aXQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHdhaXQoMzApCiAgICAgICAgICAgICAgICAgICAgX0cuVGVsZU1pcmFnZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICBfRy5Nb29uID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIF9HLlYzID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLk15c3RpY0lzbGFuZDpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiTWVzaFBhcnQiKSBhbmQgdi5NYXRlcmlhbCA9PSBFbnVtLk1hdGVyaWFsLk5lb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuTHVvbV9HZWFyID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuVGVsZU1pcmFnZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5Nb29uID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLlYzID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX0cuVHdlZW5mcnVpdCA9IHRydWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLlNwZWFrIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZnVuY3Rpb24gdG9wb3MoUG9zKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIERpc3RhbmNlID0gKFBvcy5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5TaXQgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuU2l0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKTpDcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUd2VlbkluZm8ubmV3KERpc3RhbmNlIC8gMjUwLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IENGcmFtZSA9IFBvcyB9CiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgdHdlZW46UGxheSgpCiAgICAgICAgICAgICAgICAgICAgaWYgRGlzdGFuY2UgPD0gMjUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW46Q2FuY2VsKCkKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvcwogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIF9HLlN0b3BUd2VlbiA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW46Q2FuY2VsKCkKICAgICAgICAgICAgICAgICAgICAgICAgX0cuQ2xpcCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiB0d28oZ290b0NGcmFtZSkKICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuU2l0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkFuY2hvcmVkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpWyJMb2NhbFBsYXllciJdLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ290b0NGcmFtZS5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDIwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuejpDYW5jZWwoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpWyJMb2NhbFBsYXllciJdLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IGdvdG9DRnJhbWUKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHR3ZWVuX3MgPSBnYW1lOnNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGluZm8gPSBUd2VlbkluZm8ubmV3KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpWyJMb2NhbFBsYXllciJdLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gZ290b0NGcmFtZS5Qb3NpdGlvbikuTWFnbml0dWRlIC8gOTk5OTk5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICB0d2VlbiwgZXJyID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW56ID0gdHdlZW5fczpDcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlclsiSHVtYW5vaWRSb290UGFydCJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBDRnJhbWUgPSBnb3RvQ0ZyYW1lIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuejpQbGF5KCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdHdlZW4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAicmVxdWVzdEVudHJhbmNlIiwKICAgICAgICAgICAgICAgICAgICBbMl0gPSBWZWN0b3IzLm5ldygtMTI0NjMuNjAyNTM5MDYyNSwgMzc4LjMyNzA1Njg4NDc2NTYsIC03NTY2LjA4MzAwNzgxMjUpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICB3YWl0KDEpCiAgICAgICAgICAgICAgICB0d28oQ0ZyYW1lLm5ldygtNTA0My45MjQzMiwgMzE2LjIwNTc4LCAtMjk5NC4yNjkwNCkpCiAgICAgICAgICAgICAgICB3YWl0KDEpCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC01MzU1LjYyMjU2LCAzMTMuNzE1NDg1LCAtMjQ5NS4xNzM4MykpCiAgICAgICAgICAgICAgICB3YWl0KDQpCiAgICAgICAgICAgICAgICB0d28oQ0ZyYW1lLm5ldygtNTUwMS4yODM2OSwgMTA5MC4zOTI5NCwgLTI0NjUuMjM0MzgpKQogICAgICAgICAgICAgICAgdHdvKENGcmFtZS5uZXcoLTU4NDQuMjg0MTgsIDEwNzQuMTA2ODEsIC0yMTAwLjA3NDIyKSkKICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgWzFdID0gIlJhY2VWNFByb2dyZXNzIiwKICAgICAgICAgICAgICAgICAgICBbMl0gPSAiQ2hlY2siCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJDb21tRl8iKTpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAiUmFjZVY0UHJvZ3Jlc3MiLAogICAgICAgICAgICAgICAgICAgIFsyXSA9ICJCZWdpbiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkNvbW1GXyIpOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICB3YWl0KDEpCgogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoMjgyODYuMzU1NSwgMTQ4OTYuNTM1MiwgMTAyLjYyNDY5NSkKICAgICAgICAgICAgICAgIHdhaXQoMC41KQogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoMjgyODYuMzU1NSwgMTQ4OTYuNTM1MiwgMTAyLjYyNDY5NSkKICAgICAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDI4Mjg2LjM1NTUsIDE0ODk2LjUzNTIsIDEwMi42MjQ2OTUpCiAgICAgICAgICAgICAgICB3YWl0KDEuNSkKICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDI4Mjg2LjM1NTUsIDE0ODk2LjUzNTIsIDEwMi42MjQ2OTUpCiAgICAgICAgICAgICAgICB0d28oQ0ZyYW1lLm5ldygyODYwOC42OTUzLCAxNDg5OC4xODk1LCAxMDUuOTgyNDgzKSkKICAgICAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgWzFdID0gIlJhY2VWNFByb2dyZXNzIiwKICAgICAgICAgICAgICAgICAgICBbMl0gPSAiVGVsZXBvcnRCYWNrIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiQ29tbUZfIik6SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKCiAgICAgICAgICAgICAgICB3YWl0KDEuNSkKICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgWzFdID0gIlJhY2VWNFByb2dyZXNzIiwKICAgICAgICAgICAgICAgICAgICBbMl0gPSAiVGVsZXBvcnQiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJDb21tRl8iKTpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgd2FpdCgyKQoKICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgWzFdID0gInJlcXVlc3RFbnRyYW5jZSIsCiAgICAgICAgICAgICAgICAgICAgWzJdID0gVmVjdG9yMy5uZXcoLTEyNDYzLjYwMjUzOTA2MjUsIDM3OC4zMjcwNTY4ODQ3NjU2LCAtNzU2Ni4wODMwMDc4MTI1KQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgd2FpdCgxKQogICAgICAgICAgICAgICAgdHdvKENGcmFtZS5uZXcoLTUwNDMuOTI0MzIsIDMxNi4yMDU3OCwgLTI5OTQuMjY5MDQpKQogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtNTM1NS42MjI1NiwgMzEzLjcxNTQ4NSwgLTI0OTUuMTczODMpKQoKICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgWzFdID0gIlJhY2VWNFByb2dyZXNzIiwKICAgICAgICAgICAgICAgICAgICBbMl0gPSAiQ2hlY2siCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJDb21tRl8iKTpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAiUmFjZVY0UHJvZ3Jlc3MiLAogICAgICAgICAgICAgICAgICAgIFsyXSA9ICJDb250aW51ZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkNvbW1GXyIpOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25MaWJyYXJ5OlNlbmROb3RpZmljYXRpb24oIldhcm5pbmciLCAiQ29tcGxldGVkIEZ1bmN0aW9uIiwgMTApCiAgICAgICAgICAgICAgICBfRy5TcGVhayA9IGZhbHNlCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgoK"
local decoded_script = base64.decode(encoded_script)
loadstring(decoded_script)()
