
local base64 = {}

function base64.decode(data)
    local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    data = string.gsub(data, '[^'..b..'=]', '')
    return (data:gsub('.', function(x)
        if x == '=' then return '' end
        local r, f = '', (b:find(x) - 1)
        for i = 6, 1, -1 do r = r .. (f % 2 ^ i - f % 2 ^ (i - 1) > 0 and '1' or '0') end
        return r
    end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
        if #x ~= 8 then return '' end
        local c = 0
        for i = 1, 8 do c = c + (x:sub(i, i) == '1' and 2 ^ (8 - i) or 0) end
        return string.char(c)
    end))
end

local encoded_script = "LS0tZGVvYmYgQnkgQW51cmEKLS0tZGVvYmYgQnkgQW51cmEKLS0tZGVvYmYgQnkgQW51cmEKLS0tZGVvYmYgQnkgQW51cmEKZnVuY3Rpb24gc2V0VGVhbSh0ZWFtTmFtZSkKICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgWzFdID0gIlNldFRlYW0iLAogICAgICAgIFsyXSA9IHRlYW1OYW1lCiAgICB9CiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKZW5kCgpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBfRy5TZWxlY3RfUGlyYXRlcyB0aGVuCiAgICAgICAgICAgIHNldFRlYW0oIlBpcmF0ZXMiKQogICAgICAgICAgICBfRy5TZWxlY3RfUGlyYXRlcyA9IGZhbHNlICAKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIF9HLlNlbGVjdF9NYXJpbmVzIHRoZW4KICAgICAgICAgICAgc2V0VGVhbSgiTWFyaW5lcyIpCiAgICAgICAgICAgIF9HLlNlbGVjdF9NYXJpbmVzID0gZmFsc2UgIAogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIFNjcmVlbkd1aSA9IEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIikKbG9jYWwgVGV4dExhYmVsID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQpsb2NhbCBVSUdyYWRpZW50ID0gSW5zdGFuY2UubmV3KCJVSUdyYWRpZW50IikKU2NyZWVuR3VpLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIlBsYXllckd1aSIpClNjcmVlbkd1aS5aSW5kZXhCZWhhdmlvciA9IEVudW0uWkluZGV4QmVoYXZpb3IuU2libGluZwpUZXh0TGFiZWwuUGFyZW50ID0gU2NyZWVuR3VpClRleHRMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKVGV4dExhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLjAwMApUZXh0TGFiZWwuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKVGV4dExhYmVsLkJvcmRlclNpemVQaXhlbCA9IDAKVGV4dExhYmVsLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwLjUpClRleHRMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIC0wLjAyNSwgMCkKVGV4dExhYmVsLlNpemUgPSBVRGltMi5uZXcoMCwgMjAwLCAwLCA1MCkKVGV4dExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuRnJlZG9rYU9uZQpUZXh0TGFiZWwuVGV4dCA9ICJTdWJzY3JpYmUgbWU6IEFudXJhIEdhbWluZyIKVGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQpUZXh0TGFiZWwuVGV4dFNpemUgPSAyMC4wMAoKVUlHcmFkaWVudC5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3ewoJQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb2xvcjMuZnJvbVJHQigxMzEuMDAwMDA3MzkwOTc1OTUsIDE4MS4wMDAwMDQ0MTA3NDM3LCAyNTUpKSwKCUNvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29sb3IzLmZyb21SR0IoMjI0LjAwMDAwMTg0Nzc0NCwgMTYyLjAwMDAwNTU0MzIzMTk2LCAyNTUpKQp9ClVJR3JhZGllbnQuUGFyZW50ID0gVGV4dExhYmVsCgpsb2NhbCBTY3JlZW5HdWkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIpOwpsb2NhbCBEcm9wU2hhZG93SG9sZGVyID0gSW5zdGFuY2UubmV3KCJGcmFtZSIpOwpsb2NhbCBEcm9wU2hhZG93ID0gSW5zdGFuY2UubmV3KCJJbWFnZUxhYmVsIik7CmxvY2FsIE1haW4gPSBJbnN0YW5jZS5uZXcoIkZyYW1lIik7CmxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpOwpsb2NhbCBVSVN0cm9rZSA9IEluc3RhbmNlLm5ldygiVUlTdHJva2UiKTsKbG9jYWwgVUlHcmFkaWVudCA9IEluc3RhbmNlLm5ldygiVUlHcmFkaWVudCIpOwpsb2NhbCBUID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKTsKbG9jYWwgVUlHcmFkaWVudDEgPSBJbnN0YW5jZS5uZXcoIlVJR3JhZGllbnQiKTsKClNjcmVlbkd1aS5aSW5kZXhCZWhhdmlvciA9IEVudW0uWkluZGV4QmVoYXZpb3IuU2libGluZwpTY3JlZW5HdWkuUGFyZW50ID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpCgpEcm9wU2hhZG93SG9sZGVyLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwLjUpCkRyb3BTaGFkb3dIb2xkZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKRHJvcFNoYWRvd0hvbGRlci5Cb3JkZXJTaXplUGl4ZWwgPSAwCkRyb3BTaGFkb3dIb2xkZXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLjEsIDApCkRyb3BTaGFkb3dIb2xkZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCA1MDAsIDAsIDY4KQpEcm9wU2hhZG93SG9sZGVyLlpJbmRleCA9IDAKRHJvcFNoYWRvd0hvbGRlci5OYW1lID0gIkRyb3BTaGFkb3dIb2xkZXIiCkRyb3BTaGFkb3dIb2xkZXIuUGFyZW50ID0gU2NyZWVuR3VpCgpEcm9wU2hhZG93LkltYWdlID0gInJieGFzc2V0aWQ6Ly8xNDE5MDI2MjcyMSIKRHJvcFNoYWRvdy5JbWFnZUNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCkRyb3BTaGFkb3cuSW1hZ2VUcmFuc3BhcmVuY3kgPSAwLjUKRHJvcFNoYWRvdy5TY2FsZVR5cGUgPSBFbnVtLlNjYWxlVHlwZS5TbGljZQpEcm9wU2hhZG93LlNsaWNlQ2VudGVyID0gUmVjdC5uZXcoNDksIDQ5LCA0NTAsIDQ1MCkKRHJvcFNoYWRvdy5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KQpEcm9wU2hhZG93LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCkRyb3BTaGFkb3cuQm9yZGVyU2l6ZVBpeGVsID0gMApEcm9wU2hhZG93LlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMC41LCAwKQpEcm9wU2hhZG93LlNpemUgPSBVRGltMi5uZXcoMSwgNDcsIDEsIDQ3KQpEcm9wU2hhZG93LlpJbmRleCA9IDAKRHJvcFNoYWRvdy5OYW1lID0gIkRyb3BTaGFkb3ciCkRyb3BTaGFkb3cuUGFyZW50ID0gRHJvcFNoYWRvd0hvbGRlcgoKTWFpbi5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KQpNYWluLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQpNYWluLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjUKTWFpbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQpNYWluLkJvcmRlclNpemVQaXhlbCA9IDAKTWFpbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAuNSwgMCkKTWFpbi5TaXplID0gVURpbTIubmV3KDEsIC00NywgMSwgLTQ3KQpNYWluLk5hbWUgPSAiTWFpbiIKTWFpbi5QYXJlbnQgPSBEcm9wU2hhZG93CgpVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA1KQpVSUNvcm5lci5QYXJlbnQgPSBNYWluCgpVSVN0cm9rZS5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpClVJU3Ryb2tlLlRoaWNrbmVzcyA9IDIuNQpVSVN0cm9rZS5QYXJlbnQgPSBNYWluCgpVSUdyYWRpZW50LkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7CglDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIENvbG9yMy5mcm9tUkdCKDEzMS4wMDAwMDczOTA5NzU5NSwgMTgxLjAwMDAwNDQxMDc0MzcsIDI1NSkpLAoJQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCBDb2xvcjMuZnJvbVJHQigyMjQuMDAwMDAxODQ3NzQ0LCAxNjIuMDAwMDA1NTQzMjMxOTYsIDI1NSkpCn0KVUlHcmFkaWVudC5QYXJlbnQgPSBVSVN0cm9rZQoKVC5Gb250ID0gRW51bS5Gb250LkdvdGhhbUJvbGQKVC5UZXh0ID0gIkFudXJhIEh1YiIKVC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKVC5UZXh0U2l6ZSA9IDE2LjUKVC5UZXh0WUFsaWdubWVudCA9IEVudW0uVGV4dFlBbGlnbm1lbnQuQm90dG9tClQuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDApClQuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpClQuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuOTk5MDAwMDEyODc0NjAzMwpULkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApClQuQm9yZGVyU2l6ZVBpeGVsID0gMApULlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMCwgMTUpClQuU2l6ZSA9IFVEaW0yLm5ldygwLCA1MDAsIDAsIDE4KQpULk5hbWUgPSAiVG9wIgpULlBhcmVudCA9IE1haW4KClVJR3JhZGllbnQxLkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7CglDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIENvbG9yMy5mcm9tUkdCKDEzMS4wMDAwMDczOTA5NzU5NSwgMTgxLjAwMDAwNDQxMDc0MzcsIDI1NSkpLAoJQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCBDb2xvcjMuZnJvbVJHQigyMjQuMDAwMDAxODQ3NzQ0LCAxNjIuMDAwMDA1NTQzMjMxOTYsIDI1NSkpCn0KVUlHcmFkaWVudDEuUGFyZW50ID0gVAoKVC5TaXplID0gVURpbTIubmV3KDAsIFQuVGV4dEJvdW5kcy5YLCAwLCAxOCkKaWYgVC5TaXplLlguT2Zmc2V0IHRoZW4KCURyb3BTaGFkb3dIb2xkZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCBULlRleHRCb3VuZHMuWCArIDY4LCAwLCA0OCkKZW5kClQ6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCJUZXh0Iik6Q29ubmVjdChmdW5jdGlvbigpCglULlNpemUgPSBVRGltMi5uZXcoMCwgVC5UZXh0Qm91bmRzLlgsIDAsIDE4KQoJaWYgVC5TaXplLlguT2Zmc2V0IHRoZW4KCQlEcm9wU2hhZG93SG9sZGVyLlNpemUgPSBVRGltMi5uZXcoMCwgVC5UZXh0Qm91bmRzLlggKyA2OCwgMCwgNDgpCgllbmQKZW5kKQoKZnVuY3Rpb24gU2V0VGl0bGUodikKCVQuVGV4dCA9IHYKZW5kCgpsb2NhbCBOb3RpZmljYXRpb25MaWJyYXJ5ID0gbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9sb2JveDkyMC9Ob3RpZmljYXRpb24tTGlicmFyeS9NYWluL0xpYnJhcnkubHVhIikpKCkKCk5vdGlmaWNhdGlvbkxpYnJhcnk6U2VuZE5vdGlmaWNhdGlvbigiV2FybmluZyIsICJD4bupIHThu6sgdOG7qy4uLiIsIDEwKQpOb3RpZmljYXRpb25MaWJyYXJ5OlNlbmROb3RpZmljYXRpb24oIldhcm5pbmciLCAiSGkgLCBEw7luZyB0aOG6pXkgxJHGsOG7o2Mga2jDtG5nIiwgMTApCk5vdGlmaWNhdGlvbkxpYnJhcnk6U2VuZE5vdGlmaWNhdGlvbigiV2FybmluZyIsICJGb2xsb3c6IGFudXJhX3YzIiwgMTApCgpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBfRy5TZWxlY3RfTWFyaW5lcyB0aGVuCiAgICAgICAgICAgIHNldFRlYW0oIk1hcmluZXMiKQogICAgICAgICAgICBfRy5TZWxlY3RfTWFyaW5lcyA9IGZhbHNlICAKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpmdW5jdGlvbiBBdXRvSGFraSgpCiAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgaWYgY2hhcmFjdGVyIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIYXNCdXNvIikgdGhlbgogICAgbG9jYWwgcmVtb3RlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfCiAgICBpZiByZW1vdGUgdGhlbgogICAgICByZW1vdGU6SW52b2tlU2VydmVyKCJCdXNvIikgCiAgICBlbmQKICBlbmQKZW5kCiAgICAKICAgIGZ1bmN0aW9uIFVuRXF1aXBXZWFwb24oV2VhcG9uKQogICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoV2VhcG9uKSB0aGVuCiAgICAgICAgICAgIF9HLk5vdEF1dG9FcXVpcCA9IHRydWUKICAgICAgICAgICAgd2FpdCguNSkKICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChXZWFwb24pLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgICAgICB3YWl0KC4xKQogICAgICAgICAgICBfRy5Ob3RBdXRvRXF1aXAgPSBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCgpmdW5jdGlvbiBFcXVpcFdlYXBvbihUb29sU2UpCglpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoVG9vbFNlKSB0aGVuCgkJbG9jYWwgdG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZChUb29sU2UpCgkJd2FpdCguNCkKCQlnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh0b29sKQoJZW5kCmVuZCAgICAKICAgIAogICAgZnVuY3Rpb24gRXF1aXBXZWFwb24oVG9vbFNlKQogICAgICAgIGlmIG5vdCBfRy5Ob3RBdXRvRXF1aXAgdGhlbgogICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoVG9vbFNlKSB0aGVuCiAgICAgICAgICAgICAgICBUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKFRvb2xTZSkKICAgICAgICAgICAgICAgIHdhaXQoLjEpCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChUb29sKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogIAogICAgZnVuY3Rpb24gR2V0RGlzdGFuY2UodGFyZ2V0KQogICAgICAgIHJldHVybiBtYXRoLmZsb29yKCh0YXJnZXQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSkKICAgIGVuZAogICAgCiAgICBmdW5jdGlvbiBCVFAocCkKICAgIAlwY2FsbChmdW5jdGlvbigpCgkgICAgCWlmIChwLlBvc2l0aW9uLWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID49IDE1MDAgYW5kIG5vdCBBdXRvX1JhaWQgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCgkJCQlyZXBlYXQgd2FpdCgpCgkJCQkJZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHAKCQkJCQl3YWl0KDAuNSkKCQkJCQlnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQ6RGVzdHJveSgpCgkJCQkJZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHAKCQkJCXVudGlsIChwLlBvc2l0aW9uLWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDwgMTUwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggPiAwCgkJCWVuZAoJCWVuZCkKCWVuZAogICAgZnVuY3Rpb24gVFAoUG9zKQogICAgICAgIERpc3RhbmNlID0gKFBvcy5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICBpZiBEaXN0YW5jZSA8IDMwMCB0aGVuCiAgICAgICAgICAgIFNwZWVkID0gMzAwCiAgICAgICAgZWxzZWlmIERpc3RhbmNlID49IDEwMDAgdGhlbgogICAgICAgICAgICBTcGVlZCA9IDMwMAogICAgICAgIGVuZAogICAgICAgIGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIik6Q3JlYXRlKAogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCwKICAgICAgICAgICAgVHdlZW5JbmZvLm5ldyhEaXN0YW5jZS9TcGVlZCwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpLAogICAgICAgICAgICB7Q0ZyYW1lID0gUG9zfQogICAgICAgICk6UGxheSgpCiAgICAgICAgX0cuQ2xpcCA9IHRydWUKICAgICAgICB3YWl0KERpc3RhbmNlL1NwZWVkKQogICAgICAgIF9HLkNsaXAgPSBmYWxzZQogICAgZW5kCgpmdW5jdGlvbiBNaW5oRGVwWmFpKFBvcykKICAgICAgICBEaXN0YW5jZSA9IChQb3MuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuU2l0ID09IHRydWUgdGhlbiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlNpdCA9IGZhbHNlIGVuZAogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkgdHdlZW4gPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpOkNyZWF0ZShnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQsVHdlZW5JbmZvLm5ldyhEaXN0YW5jZS8zMTUsIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyKSx7Q0ZyYW1lID0gUG9zfSkgZW5kKQogICAgICAgIHR3ZWVuOlBsYXkoKQogICAgICAgIGlmIERpc3RhbmNlIDw9IDIwMCB0aGVuCiAgICAgICAgICAgIHR3ZWVuOkNhbmNlbCgpCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBQb3MKICAgICAgICBlbmQKICAgICAgICBpZiBfRy5TdG9wVHdlZW4gPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgIHR3ZWVuOkNhbmNlbCgpCiAgICAgICAgICAgIF9HLkNsaXAgPSBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCgogICAgZnVuY3Rpb24gQ2hlY2tOZWFyZXN0VGVsZXBvcnRlcihhSSkKICAgICAgICBsb2NhbCBNeUxldmVsID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkRhdGEuTGV2ZWwuVmFsdWUKICAgICAgICB2Y3Nwb3MgPSBhSS5Qb3NpdGlvbgogICAgICAgIG1pbiA9IG1hdGguaHVnZQogICAgICAgIG1pbjIgPSBtYXRoLmh1Z2UKICAgICAgICBsb2NhbCB5ID0gZ2FtZS5QbGFjZUlkCiAgICAgICAgaWYgeSA9PSAyNzUzOTE1NTQ5IHRoZW4KICAgICAgICAgICAgT2xkV29ybGQgPSB0cnVlCiAgICAgICAgZWxzZWlmIHkgPT0gNDQ0MjI3MjE4MyB0aGVuCiAgICAgICAgICAgIE5ld1dvcmxkID0gdHJ1ZQogICAgICAgIGVsc2VpZiB5ID09IDc0NDk0MjM2MzUgdGhlbgogICAgICAgICAgICBUaHJlZVdvcmxkID0gdHJ1ZQogICAgICAgIGVuZCAgCiAgICAgICAgaWYgV29ybGQzIHRoZW4KICAgICAgICAgICAgVGFibGVMb2NhdGlvbnMgPSB7CiAgICAgICAgICAgICAgICBbIkNhc2x0ZSBPbiBUaGUgU2VhIl0gPSBWZWN0b3IzLm5ldygtNTA1OC43NzQ5MDIzNDM3NSwgMzE0LjUxNTUwMjkyOTY4NzUsIC0zMTU1Ljg4MzMwMDc4MTI1KSwKICAgICAgICAgICAgICAgIFsiSHlkcmEiXSA9IFZlY3RvcjMubmV3KDU2NjEuNTMwMjczNDM3NSwgMTAxMy4zNTg3MDM2MTMyODEyLCAtMzM0Ljk2MTkxNDA2MjUpLAogICAgICAgICAgICAgICAgWyJNYW5zaW9uIl0gPSBWZWN0b3IzLm5ldygtMTI0NjMuODc0MDIzNDM3NSwgMzc0LjkxNDQ1OTIyODUxNTYsIC03NTIzLjc3MzkyNTc4MTI1KSwKICAgICAgICAgICAgICAgIFsiR3JlYXQgVHJlZSJdID0gVmVjdG9yMy5uZXcoMjgyODIuNTcwMzEyNSwgMTQ4OTYuODUwNTg1OTM3NSwgMTA1LjEwNDI3MDkzNTA1ODYpLAogICAgICAgICAgICAgICAgWyJOZ3UxIl0gPSBWZWN0b3IzLm5ldygtMTE5OTMuNTgwMDc4MTI1LCAzMzQuNzgxMjgwNTE3NTc4MSwgLTg4NDQuMTgyNjE3MTg3NSksCiAgICAgICAgICAgICAgICBbIm5ndTIiXSA9IFZlY3RvcjMubmV3KDUzMTQuNTgyMDMxMjUsIDI1LjQxOTM4NzgxNzM4MjgxMiwgLTEyNS45NDIyNzYwMDA5NzY1NikKICAgICAgICAgICAgfQogICAgICAgIGVsc2VpZiBXb3JsZDIgdGhlbgogICAgICAgICAgICBUYWJsZUxvY2F0aW9ucyA9IHsKICAgICAgICAgICAgICAgIFsiTWFuc2lvbiJdID0gVmVjdG9yMy5uZXcoLTI4OC40NjI0NjMzNzg5MDYyNSwgMzA2LjEzMDYxNTIzNDM3NSwgNTk3Ljk5ODg0MDMzMjAzMTIpLAogICAgICAgICAgICAgICAgWyJGbGFtaW5nbyJdID0gVmVjdG9yMy5uZXcoMjI4NC45MTIxMDkzNzUsIDE1LjE1MjA0NjIwMzYxMzI4MSwgOTA1LjQ4MjkxMDE1NjI1KSwKICAgICAgICAgICAgICAgIFsiMTIyIl0gPSBWZWN0b3IzLm5ldyg5MjMuMjEyNTI0NDE0MDYsIDEyNi45NzYwMDU1NTQyLCAzMjg1Mi44MzIwMzEyNSksCiAgICAgICAgICAgICAgICBbIjMwMzIiXSA9IFZlY3RvcjMubmV3KC02NTA4LjU1ODEwNTQ2ODgsIDg5LjAzNDk5NjAzMjcxNSwgLTEzMi44Mzk1Mzg1NzQyMikKICAgICAgICAgICAgfQogICAgICAgIGVsc2VpZiBXb3JsZDEgdGhlbgogICAgICAgICAgICBUYWJsZUxvY2F0aW9ucyA9IHsKICAgICAgICAgICAgICAgIFsiMSJdID0gVmVjdG9yMy5uZXcoLTc4OTQuNjIwMTE3MTg3NSwgNTU0NS40OTE2OTkyMTg3NSwgLTM4MC4yNDY3MzQ2MTkxNDA2KSwKICAgICAgICAgICAgICAgIFsiMiJdID0gVmVjdG9yMy5uZXcoLTQ2MDcuODIyNzUzOTA2MjUsIDg3Mi41NDIyOTczNjMyODEyLCAtMTY2Ny41NTY4ODQ3NjU2MjUpLAogICAgICAgICAgICAgICAgWyIzIl0gPSBWZWN0b3IzLm5ldyg2MTE2My44NTE1NjI1LCAxMS43NTk1MjI0MzgwNDkzMTYsIDE4MTkuNzg0MTc5Njg3NSksCiAgICAgICAgICAgICAgICBbIjQiXSA9IFZlY3RvcjMubmV3KDM4NzYuMjgwNTE3NTc4MTI1LCAzNS4xMDYxNDAxMzY3MTg3NSwgLTE5MzkuMzIwMTkwNDI5Njg3NSkKICAgICAgICAgICAgfQogICAgICAgIGVuZAogICAgICAgIFRhYmxlTG9jYXRpb25zMiA9IHt9CiAgICAgICAgZm9yIHIsIHYgaW4gcGFpcnMoVGFibGVMb2NhdGlvbnMpIGRvCiAgICAgICAgICAgIFRhYmxlTG9jYXRpb25zMltyXSA9ICh2IC0gdmNzcG9zKS5NYWduaXR1ZGUKICAgICAgICBlbmQKICAgICAgICBmb3IgciwgdiBpbiBwYWlycyhUYWJsZUxvY2F0aW9uczIpIGRvCiAgICAgICAgICAgIGlmIHYgPCBtaW4gdGhlbgogICAgICAgICAgICAgICAgbWluID0gdgogICAgICAgICAgICAgICAgbWluMiA9IHYKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgZm9yIHIsIHYgaW4gcGFpcnMoVGFibGVMb2NhdGlvbnMyKSBkbwogICAgICAgICAgICBpZiB2IDwgbWluIHRoZW4KICAgICAgICAgICAgICAgIG1pbiA9IHYKICAgICAgICAgICAgICAgIG1pbjIgPSB2CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGZvciByLCB2IGluIHBhaXJzKFRhYmxlTG9jYXRpb25zMikgZG8KICAgICAgICAgICAgaWYgdiA8PSBtaW4gdGhlbgogICAgICAgICAgICAgICAgY2hvb3NlID0gVGFibGVMb2NhdGlvbnNbcl0KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgbWluMyA9ICh2Y3Nwb3MgLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgIGlmIG1pbjIgPD0gbWluMyB0aGVuCiAgICAgICAgICAgIHJldHVybiBjaG9vc2UKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBmdW5jdGlvbiByZXF1ZXN0RW50cmFuY2UoYUopCiAgICAgICAgYXJncyA9IHsicmVxdWVzdEVudHJhbmNlIiwgYUp9CiAgICAgICAgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgIG9sZGNmcmFtZSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgY2hhci5DRnJhbWUgPSBDRnJhbWUubmV3KG9sZGNmcmFtZS5YLCBvbGRjZnJhbWUuWSArIDUwLCBvbGRjZnJhbWUuWikKICAgICAgICB0YXNrLndhaXQoMC41KQogICAgZW5kCiAgICAKICAgIGZ1bmN0aW9uIEFudGlMb3dIZWFsdGgoYUspCiAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9CiAgICAgICAgICAgIENGcmFtZS5uZXcoCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWCwKICAgICAgICAgICAgYUssCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWgogICAgICAgICkKICAgICAgICB3YWl0KCkKICAgIGVuZAogICAgVHdlZW5TcGVlZCA9IDMwMAogICAgZnVuY3Rpb24gdG9wb3MoYUwpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIgYW5kIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFR3ZWVuU3BlZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNwZWVkID0gMzAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgRGVmdWFsdFkgPSBhTC5ZCiAgICAgICAgICAgICAgICAgICAgVGFyZ2V0WSA9IGFMLlkKICAgICAgICAgICAgICAgICAgICB0YXJnZXRDRnJhbWVXaXRoRGVmdWFsdFkgPSBDRnJhbWUubmV3KGFMLlgsIERlZnVhbHRZLCBhTC5aKQogICAgICAgICAgICAgICAgICAgIHRhcmdldFBvcyA9IGFMLlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgb2xkY2ZyYW1lID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgIERpc3RhbmNlID0gKHRhcmdldFBvcyAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKS5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgaWYgRGlzdGFuY2UgPD0gMzAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IGFMCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYU0gPSBDaGVja05lYXJlc3RUZWxlcG9ydGVyKGFMKQogICAgICAgICAgICAgICAgICAgIGlmIGFNIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuOkNhbmNlbCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RFbnRyYW5jZShhTSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBiMSA9IENGcmFtZS5uZXcoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5YLERlZnVhbHRZLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWikKICAgICAgICAgICAgICAgICAgICBpZiBJbmdvcmVZIGFuZCAoYjEuUG9zaXRpb24gLSB0YXJnZXRDRnJhbWVXaXRoRGVmdWFsdFkuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlgsRGVmdWFsdFksZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5aKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0d2VlbmZ1bmMgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhTiA9IGdhbWU6c2VydmljZSAiVHdlZW5TZXJ2aWNlIgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhTyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUd2VlbkluZm8ubmV3KCh0YXJnZXRQb3MgLWdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKS5Qb3NpdGlvbikuTWFnbml0dWRlIC9Ud2VlblNwZWVkLEVudW0uRWFzaW5nU3R5bGUuTGluZWFyKQogICAgICAgICAgICAgICAgICAgICAgICB0d2VlbiA9IGFOOkNyZWF0ZShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXJbIkh1bWFub2lkUm9vdFBhcnQiXSxhTyx7Q0ZyYW1lID0gdGFyZ2V0Q0ZyYW1lV2l0aERlZnVhbHRZfSkKICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW46UGxheSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHR3ZWVuZnVuYzpTdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuOkNhbmNlbCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICB0d2Vlbi5Db21wbGV0ZWQ6V2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWCxUYXJnZXRZLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWikKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHR3ZWVuZnVuYyA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFOID0gZ2FtZTpzZXJ2aWNlICJUd2VlblNlcnZpY2UiCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFPID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuSW5mby5uZXcoKHRhcmdldFBvcyAtZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpLlBvc2l0aW9uKS5NYWduaXR1ZGUgL1R3ZWVuU3BlZWQsRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpCiAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuID0gYU46Q3JlYXRlKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlclsiSHVtYW5vaWRSb290UGFydCJdLGFPLHtDRnJhbWUgPSBhTH0pCiAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuOlBsYXkoKQogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB0d2VlbmZ1bmM6U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0d2VlbjpDYW5jZWwoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW4uQ29tcGxldGVkOldhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID1DRnJhbWUubmV3KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWCxUYXJnZXRZLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgdHdlZW4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHdlZW4KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHdlZW5mdW5jCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgKQogICAgZW5kCkluZ29yZVkgPSB0cnVlClR5cGUgPSAxCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoLjEpIGRvCgkJaWYgVHlwZSA9PSAxIHRoZW4KCQkJUG9zID0gQ0ZyYW1lLm5ldygwLFBvc1ksLTMwKQoJCWVsc2VpZiBUeXBlID09IDIgdGhlbgoJCQlQb3MgPSBDRnJhbWUubmV3KDMwLFBvc1ksMCkKCQllbHNlaWYgVHlwZSA9PSAzIHRoZW4KCQkJUG9zID0gQ0ZyYW1lLm5ldygwLFBvc1ksMzApCQoJCWVsc2VpZiBUeXBlID09IDQgdGhlbgoJCQlQb3MgPSBDRnJhbWUubmV3KC0zMCxQb3NZLDApCiAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCgpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KDAuNSkgZG8KICAgICAgICBUeXBlID0gMQogICAgICAgIHdhaXQoMC40KQogICAgICAgIFR5cGUgPSAyCiAgICAgICAgd2FpdCgwLjMpCiAgICAgICAgVHlwZSA9IDMKICAgICAgICB3YWl0KDAuNCkKICAgICAgICBUeXBlID0gNAogICAgICAgIHdhaXQoMC4yKQogICAgICAgIFR5cGUgPSA1CiAgICAgICAgd2FpdCgwLjMpCiAgICBlbmQKZW5kKQoKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCguMSkgZG8KICAgICAgICBGcmFtZSA9IDEKICAgICAgICB3YWl0KDAuNCkKICAgICAgICBGcmFtZSA9IDIKICAgICAgICB3YWl0KDAuNCkKICAgICAgICBGcmFtZSA9IDMKICAgICAgICB3YWl0KDAuMykKICAgICAgICBGcmFtZSA9IDQKICAgICAgICB3YWl0KDAuNCkKICAgICAgICBGcmFtZSA9IDUKICAgICAgICB3YWl0KDAuMykKICAgIGVuZAplbmQpCgpUeXBlID0gMQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KC4xKSBkbwogICAgICAgIGlmIEZyYW1lID09IDEgdGhlbgogICAgICAgICAgICBDaGVjayA9IENGcmFtZS5uZXcoMCw1MCwwKQoJCWVsc2VpZiBGID09IDIgdGhlbgoJCQlDaGVjayA9IENGcmFtZS5uZXcoMCwwLC0xMDApCgkJZWxzZWlmIEYgPT0gMyB0aGVuCgkJCUNoZWNrID0gQ0ZyYW1lLm5ldygxMDAsMCwwKQoJCWVsc2VpZiBGID09IDQgdGhlbgoJCQlDaGVjayA9IENGcmFtZS5uZXcoMCwwLDEwMCkJCgkJZWxzZWlmIEYgPT0gNSB0aGVuCgkJCUNoZWNrID0gQ0ZyYW1lLm5ldygtMTAwLDAsMCkKCQllbHNlaWYgRiA9PSA2IHRoZW4KCQkJQ2hlY2sgPSBDRnJhbWUubmV3KDAsNTAsMCkKICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoLjEpIGRvCiAgICAgICAgRiA9IDEKICAgICAgICB3YWl0KDAuNSkKICAgICAgICBGID0gMgogICAgICAgIHdhaXQoMC41KQogICAgICAgIEYgPSAzCiAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgRiA9IDQKICAgICAgICB3YWl0KDAuNSkKICAgICAgICBGID0gNQogICAgICAgIHdhaXQoMC41KQogICAgZW5kCmVuZCkKCgpmdW5jdGlvbiBUUEIoQ0ZnbykKbG9jYWwgdHdlZW5fcyA9IGdhbWU6c2VydmljZSJUd2VlblNlcnZpY2UiCmxvY2FsIGluZm8gPSBUd2VlbkluZm8ubmV3KChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkJvYXRzLlBpcmF0ZUJyaWdhZGUuVmVoaWNsZVNlYXQuQ0ZyYW1lLlBvc2l0aW9uIC0gQ0Znby5Qb3NpdGlvbikuTWFnbml0dWRlLzMwMCwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpCnR3ZWVuID0gdHdlZW5fczpDcmVhdGUoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5Cb2F0cy5QaXJhdGVCcmlnYWRlLlZlaGljbGVTZWF0LCBpbmZvLCB7Q0ZyYW1lID0gQ0Znb30pCnR3ZWVuOlBsYXkoKQoKbG9jYWwgdHdlZW5mdW5jID0ge30KCmZ1bmN0aW9uIHR3ZWVuZnVuYzpTdG9wKCkKICAgIHR3ZWVuOkNhbmNlbCgpCmVuZAoKcmV0dXJuIHR3ZWVuZnVuYwplbmQKCmZ1bmN0aW9uIFRQUChDRmdvKQoJaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikuSGVhbHRoIDw9IDAgb3Igbm90IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikgdGhlbiB0d2VlbjpDYW5jZWwoKSByZXBlYXQgd2FpdCgpIHVudGlsIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikgYW5kIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikuSGVhbHRoID4gMCB3YWl0KDcpIHJldHVybiBlbmQKCWxvY2FsIHR3ZWVuX3MgPSBnYW1lOnNlcnZpY2UiVHdlZW5TZXJ2aWNlIgoJbG9jYWwgaW5mbyA9IFR3ZWVuSW5mby5uZXcoKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpWyJMb2NhbFBsYXllciJdLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gQ0Znby5Qb3NpdGlvbikuTWFnbml0dWRlLzMyNSwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpCgl0d2VlbiA9IHR3ZWVuX3M6Q3JlYXRlKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXJbIkh1bWFub2lkUm9vdFBhcnQiXSwgaW5mbywge0NGcmFtZSA9IENGZ299KQoJdHdlZW46UGxheSgpCgoJbG9jYWwgdHdlZW5mdW5jID0ge30KCglmdW5jdGlvbiB0d2VlbmZ1bmM6U3RvcCgpCgkJdHdlZW46Q2FuY2VsKCkKCWVuZAoKCXJldHVybiB0d2VlbmZ1bmMKZW5kCgpmdW5jdGlvbiBFcXVpcFdlYXBvblN3b3JkKCkKCXBjYWxsKGZ1bmN0aW9uKCkKCQlmb3IgaSx2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwoJCQlpZiB2LlRvb2xUaXAgPT0gIlN3b3JkIiBhbmQgdjpJc0EoJ1Rvb2wnKSB0aGVuCgkJCQlsb2NhbCBUb29sSHVtYW5vaWQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQodi5OYW1lKSAKCQkJCWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKFRvb2xIdW1hbm9pZCkgCgkJCWVuZAoJCWVuZAoJZW5kKQplbmQKCmZ1bmN0aW9uIEVxdWlwV2VhcG9uR3VuKCkKCXBjYWxsKGZ1bmN0aW9uKCkKCQlmb3IgaSx2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwoJCQlpZiB2LlRvb2xUaXAgPT0gIkd1biIgYW5kIHY6SXNBKCdUb29sJykgdGhlbgoJCQkJbG9jYWwgVG9vbEh1bWFub2lkID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHYuTmFtZSkgCgkJCQlnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChUb29sSHVtYW5vaWQpIAoJCQllbmQKCQllbmQKCWVuZCkKZW5kCgpnZXRnZW52KCkuVG9UYXJnZXRzID0gZnVuY3Rpb24ocCkKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI6RGlzdGFuY2VGcm9tQ2hhcmFjdGVyKHAuUG9zaXRpb24pIDw9IDI1MCB0aGVuIAogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gcAogICAgICAgICAgICBlbHNlaWYgbm90IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJvb3QiKXRoZW4gCiAgICAgICAgICAgICAgICBsb2NhbCBLID0gSW5zdGFuY2UubmV3KCJQYXJ0IixnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKQogICAgICAgICAgICAgICAgSy5TaXplID0gVmVjdG9yMy5uZXcoMSwwLjUsMSkKICAgICAgICAgICAgICAgIEsuTmFtZSA9ICJSb290IgogICAgICAgICAgICAgICAgSy5BbmNob3JlZCA9IHRydWUKICAgICAgICAgICAgICAgIEsuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgSy5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgIEsuQ0ZyYW1lID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMCwyMCwwKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbG9jYWwgVSA9IChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24tcC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgIGxvY2FsIHogPSBnYW1lOnNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCiAgICAgICAgICAgIGxvY2FsIEIgPSBUd2VlbkluZm8ubmV3KChwLlBvc2l0aW9uLWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUm9vdC5Qb3NpdGlvbikuTWFnbml0dWRlLzMwMCxFbnVtLkVhc2luZ1N0eWxlLkxpbmVhcikKICAgICAgICAgICAgbG9jYWwgUyxnID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBxID0gejpDcmVhdGUoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5Sb290LEIse0NGcmFtZSA9IHB9KQogICAgICAgICAgICBxOlBsYXkoKQogICAgICAgIGVuZCkKICAgICAgICBpZiBub3QgUyB0aGVuIAogICAgICAgICAgICByZXR1cm4gZwogICAgICAgIGVuZAogICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUm9vdC5DRnJhbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgIGlmIFMgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJvb3QiKSB0aGVuIAogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24tcC5Qb3NpdGlvbikuTWFnbml0dWRlID49IDIwIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5Sb290LlBvc2l0aW9uLWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMTUwIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUm9vdC5DRnJhbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZT1nYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJvb3QuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbi1wLlBvc2l0aW9uKS5NYWduaXR1ZGUgPj0gMTAgYW5kKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbi1wLlBvc2l0aW9uKS5NYWduaXR1ZGUgPCAyMCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gcAogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uLXAuUG9zaXRpb24pLk1hZ25pdHVkZSA8IDEwIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAoJICAgIGVuZCkKICAgIGVuZCkKICAgIGVuZAoKICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICAgICAgaWYgX0cuQXV0b19Cb25lMiBvciBfRy5MaW9uRml4RHJpdmUgb3IgX0cuTmVjaGlldSBvciBfRy5BdXRvRmFybUJvc3NIYWxsb3cgb3IgX0cuQXV0b19Cb25lMiBvciBPdmVyIG9yIE92ZXIyIG9yIFJ1biBvciBSdW4yIG9yIF9HLkF1dG9LYXRhIG9yIF9HLkF1dG9MZXZlbDIgb3IgX0cuQXV0b0Zhcm1OZWFyZXN0IG9yIF9HLkF1dG9Cb3NzIG9yIF9HLkZhcm1mYXN0IG9yIF9HLlR3ZWVuZnJ1aXQgb3IgX0cuQXV0b19EdW5nZW9uIG9yIF9HLktpbGxfVjQgb3IgX0cua2lsbG5vc2tpbGwgb3IgX0cuQXV0b1F1ZXN0UmFjZSBvciBfRy5SYURhb0toaSBvciBfRy5MdW9tX0dlYXIgb3IgX0cuRGFvQmlMb24gb3IgX0cuQXV0b1NlY29uZFNlYSBvciBfRy5BdXRvX0V2b1JhY2Ugb3IgX0cuQXV0b19EcmFnb25fVHJpZGVudCBvciBfRy5BdXRvX0tpbGxfUGx5IG9yIF9HLlRlbGVwb3J0IG9yIF9HLkVsaV9OZ3Ugb3IgX0cuQ2h1YXRlX0JhY19HaWFuZyBvciBfRy5BdXRvQ2FydmVuZGVyIG9yIF9HLkRpX25naGlhX3Z1X3F1YW5fc3Ugb3IgX0cuQXV0b0VjdG9wbGFzbSBvciBfRy5LaWVtX0x1YSBvciBBdXRvX0tpX0RpIG9yIF9HLkF1dG9Qb2xlIG9yIF9HLkF1dG9QbGF5ZXJIdW50ZXIgb3IgX0cuQXV0b01hdGVyaWFsIG9yIF9HLkF1dG9fU2FiZXIgb3IgX0cuVHdlZW5Ub0tpdHN1bmUgb3IgX0cuQXV0b19OaGFfRGllbiBvciBfRy5UZWxlcG9ydE5QQyBvciBfRy5BdXRvRGFya0RhZ2dlciBvciBfRy5DaG9uSGFraSBvciBfRy5SYWlkUGlyYXRlIG9yIF9HLkF1dG9PYnNlcnZhdGlvbiBvciBfRy5BdXRvRmFybSBvciBfRy5BdXRvSGFraVYyIG9yIF9HLkNvbGxlY3RBenVyZSBvciBfRy5DaXRpemVuUXVlc3Qgb3IgX0cuVGVsZXBvcnRJc2xhbmQgb3IgX0cuVGVsZXBvcnRQbHkgb3IgX0cuTGlvbkF1dG9Ecml2ZUJvYXQgb3IgX0cuRmFybUJvbmVBY2llbnQgb3IgX0cuQXV0b0Zhcm1GcnVpdE1hc3Rlcnkgb3IgX0cuQXV0b0Zhcm1HdW5NYXN0ZXJ5IG9yIF9HLkF1dG9Td29yZE1hc3Rlcnkgb3IgX0cuQXV0b0NhbWUgb3IgX0cuYXV0b0xhd1JhaWQgb3IgX0cuQXV0b19TZWFiZXN0IG9yIF9HLkF1dG9UZXJyb3JzaGFyayBvciBGYXJtU2hhcmsgb3IgX0cuZmFybXBpcmFueWEgb3IgX0cuRmlzaF9DcmV3X01lbWJlciBvciBfRy5BdXRvU2hpcCBvciBfRy5iamlyRmlzaEJvYXQgb3IgX0cuYmppckZpc2hCb2F0IG9yIF9HLkF1dG9TZWFCZXN0IG9yIF9HLlR3ZWVuRnJvIG9yIEdyYWJfQ2hlc3QxIG9yIEdyYWJfQ2hlc3QyIG9yIF9HLkF1dG9GYXJtQm9zcyA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQ6RmluZEZpcnN0Q2hpbGQoIkJvZHlDbGlwIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBOb2NsaXAgPSBJbnN0YW5jZS5uZXcoIkJvZHlWZWxvY2l0eSIpCiAgICAgICAgICAgICAgICAgICAgICAgIE5vY2xpcC5OYW1lID0gIkJvZHlDbGlwIgogICAgICAgICAgICAgICAgICAgICAgICBOb2NsaXAuUGFyZW50ID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgTm9jbGlwLk1heEZvcmNlID0gVmVjdG9yMy5uZXcoMTAwMDAwLDEwMDAwMCwxMDAwMDApCiAgICAgICAgICAgICAgICAgICAgICAgIE5vY2xpcC5WZWxvY2l0eSA9IFZlY3RvcjMubmV3KDAsMCwwKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZCkKICAKICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBfRy5BdXRvX0JvbmUyIG9yIF9HLkxpb25GaXhEcml2ZSBvciBfRy5OZWNoaWV1IG9yIF9HLkF1dG9GYXJtQm9zc0hhbGxvdyBvciBPdmVyIG9yIE92ZXIyIG9yIFJ1biBvciBSdW4yIG9yIF9HLkF1dG9LYXRhIG9yIF9HLkF1dG9MZXZlbDIgb3IgX0cuQXV0b0Jvc3Mgb3IgX0cuRmFybWZhc3Qgb3IgX0cuVHdlZW5mcnVpdCBvciBfRy5BdXRvX0R1bmdlb24gb3IgX0cuS2lsbF9WNCBvciBfRy5raWxsbm9za2lsbCBvciBfRy5BdXRvUXVlc3RSYWNlIG9yIF9HLlJhRGFvS2hpIG9yIF9HLkx1b21fR2VhciBvciBfRy5EYW9CaUxvbiBvciBfRy5BdXRvU2Vjb25kU2VhIG9yIF9HLkF1dG9fRXZvUmFjZSBvciBfRy5BdXRvX0RyYWdvbl9UcmlkZW50IG9yIF9HLkJheURhbyBvciBfRy5FbGlfTmd1IG9yIF9HLkNodWF0ZV9CYWNfR2lhbmcgb3IgX0cuQXV0b0NhcnZlbmRlciBvciBfRy5EaV9uZ2hpYV92dV9xdWFuX3N1IG9yIF9HLkF1dG9FY3RvcGxhc20gb3IgX0cuS2llbV9MdWEgb3IgQXV0b19LaV9EaSBvciBfRy5LaGlfRG90X0xlbl9EaWVuIG9yIF9HLkF1dG9QbGF5ZXJIdW50ZXIgb3IgX0cuRmFybUJvbmVBY2llbnQgb3IgX0cuQXV0b0Zhcm1GcnVpdE1hc3Rlcnkgb3IgX0cuQXV0b0Zhcm1HdW5NYXN0ZXJ5IG9yIF9HLkF1dG9Td29yZE1hc3Rlcnkgb3IgX0cuVHdlZW5Ub0tpdHN1bmUgb3IgX0cuQXV0b19OaGFfRGllbiBvciBfRy5BdXRvTWF0ZXJpYWwgb3IgX0cuVGVsZXBvcnROUEMgb3IgX0cuQXV0b0RhcmtEYWdnZXIgb3IgX0cuQXV0b0Zhcm0gb3IgX0cuQ2hvbkhha2kgb3IgX0cuUmFpZFBpcmF0ZSBvciBfRy5BdXRvT2JzZXJ2YXRpb24gb3IgX0cuQXV0b0hha2lWMiBvciBfRy5Db2xsZWN0QXp1cmUgb3IgX0cuQ2l0aXplblF1ZXN0IG9yIF9HLlRlbGVwb3J0SXNsYW5kIG9yIF9HLlRlbGVwb3J0UGx5IG9yIF9HLkNhY1JhY2Ugb3IgX0cuTGlvbkF1dG9Ecml2ZUJvYXQgb3IgX0cuTGlvbkF1dG9Ecml2ZUJvYXQyIG9yIF9HLkF1dG9UZXJyb3JzaGFyayBvciBGYXJtU2hhcmsgb3IgX0cuZmFybXBpcmFueWEgb3IgX0cuRmlzaF9DcmV3X01lbWJlciBvciBfRy5BdXRvU2hpcCBvciBfRy5BdXRvU2VhQmVzdCBvciBfRy5hdXRvTGF3UmFpZCBvciBfRy5BdXRvX1NlYWJlc3Qgb3IgX0cuQnVvaSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5DYW5Db2xsaWRlID0gZmFsc2UgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQpCiAgICBlbmQpICAgCiAgICAKZnVuY3Rpb24gQ2xpY2soKQogICAgICAgIGlmIG5vdCBfRy5GYXN0QXR0YWNrIHRoZW4KICAgICAgICAgICAgbG9jYWwgTW9kdWxlID0gcmVxdWlyZShnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuUGxheWVyU2NyaXB0cy5Db21iYXRGcmFtZXdvcmspCiAgICAgICAgICAgIGxvY2FsIENvbWJhdEZyYW1ld29yayA9IGRlYnVnLmdldHVwdmFsdWVzKE1vZHVsZSlbMl0KICAgICAgICAgICAgbG9jYWwgQ2FNb2JOYW1laGFrZSA9IHJlcXVpcmUoZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5VdGlsLkNhbWVyYVNoYWtlcikKICAgICAgICAgICAgQ2FNb2JOYW1laGFrZTpTdG9wKCkKICAgICAgICAgICAgQ29tYmF0RnJhbWV3b3JrLmFjdGl2ZUNvbnRyb2xsZXIuYXR0YWNraW5nID0gZmFsc2UKICAgICAgICAgICAgQ29tYmF0RnJhbWV3b3JrLmFjdGl2ZUNvbnRyb2xsZXIudGltZVRvTmV4dEF0dGFjayA9IDAKICAgICAgICAgICAgQ29tYmF0RnJhbWV3b3JrLmFjdGl2ZUNvbnRyb2xsZXIuaGl0Ym94TWFnbml0dWRlID0gMTgwCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSAnVmlydHVhbFVzZXInOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlICdWaXJ0dWFsVXNlcic6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICBlbmQKICAgIGVuZAogICAgCnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgaWYgT3ZlciBvciBfRy5BdXRvX0JvbmUyIG9yIF9HLktpbGxfVjQgb3IgX0cua2lsbG5vc2tpbGwgb3IgX0cuQXV0b19LaWxsX1BseSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRTpGaXJlU2VydmVyKCJLZW4iLHRydWUpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZCAgICAKICAgICAgICBlbmQKICAgIGVuZCkgICAgCiAgICAKICAgIGZ1bmN0aW9uIEluc3RhbmNlUG9zKHBvcykKICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gcG9zCiAgICBlbmQgICAgCiAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbyAgCiAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIlJlbW90ZUZ1bmN0aW9uU2hvb3QiKSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0V2VhcG9uR3VuID0gdi5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZCkKICAgIAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuSWRsZWQ6Y29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkJ1dHRvbjJEb3duKFZlY3RvcjIubmV3KDAsMCksd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lKQogICAgICAgIHdhaXQoMSkKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6QnV0dG9uMlVwKFZlY3RvcjIubmV3KDAsMCksd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lKQogICAgZW5kKSAKCmxvY2FsIFBsYXllck5hbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuRGlzcGxheU5hbWUKcmVxdWlyZShnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlLk5vdGlmaWNhdGlvbikubmV3KCI8Q29sb3I9Qmx1ZT4iIC4uUGxheWVyTmFtZS4uICI8Q29sb3I9Lz4iKTpEaXNwbGF5KCkKCgoKc2V0ZnBzY2FwKDYwKQoKbG9jYWwgTWluaERlcFphaSA9IENGcmFtZS5uZXcoLTk1MDYuMjM0Mzc1LCAxNzIuMTMwNjE1MjM0Mzc1LCA2MTE3LjA3NzE0ODQzNzUpCmxvY2FsIENha2VQb3MgPSBDRnJhbWUubmV3KC0xOTc4LjQ1NzE1LCAyNTEuNTM1Mjk0LCAtMTIzOTUuMjk3OSkKbG9jYWwgSmFja0JvQ29uID0gQ0ZyYW1lLm5ldygtNzc0OC4wMTg1NTQ2ODc1LCA1NjA2LjgwNjE1MjM0Mzc1LCAtMjMwNS44OTg2ODE2NDA2MjUpCmxvY2FsIERvbWRvbSA9IENGcmFtZS5uZXcoLTUzNDQuODIyMjY1NjI1LCA0MjMuOTg1NDEyNTk3NjYsIC0yNzI1LjA5MzAxNzU3ODEpCmxvY2FsIExvbmdNYSA9IENGcmFtZS5uZXcoLTEwMjM4Ljg3NTk3NjU2MywgMzg5Ljc5MTI5MDI4MzIsIC05NTQ5Ljc5Mzk0NTMxMjUpCmxvY2FsIE11YVRoID0gQ0ZyYW1lLm5ldygtMTY5MjcuNDUxMTcxODc1LCA5LjA4NjM2MTg4NTA3MDgsIDQzMy44NjQyODgzMzAwNzgxKQoKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIHBsYXllckNvdW50ID0gI2dhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkdldFBsYXllcnMoKQoKbG9jYWwgcGxhY2VJZCA9IGdhbWUuUGxhY2VJZApsb2NhbCBqb2JJZCA9IGdhbWUuSm9iSWQKCmxvY2FsIENoZWNrTHVPY0NobyA9ICNnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKTpHZXRQbGF5ZXJzKCkKCl9HLkJyaW5nTW9kZSA9IDMwMApQb3NZID0gNDUKQXV0b0hha2koKQoKc3Bhd24oZnVuY3Rpb24oKQoJZnVuY3Rpb24gTWluaERlcFphaSgpCgkJZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNhcHR1cmVDb250cm9sbGVyKCkKCQlnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKCWVuZAplbmQpCgpmdW5jdGlvbiBTdG9wVHdlZW4odGFyZ2V0KQogICAgICAgIGlmIG5vdCB0YXJnZXQgdGhlbgogICAgICAgIF9HLlN0b3BUd2VlbiA9IHRydWUKICAgICAgICB3YWl0KCkKICAgICAgICB0b3BvcyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgd2FpdCgpCiAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQ6RmluZEZpcnN0Q2hpbGQoIkJvZHlDbGlwIikgdGhlbgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0OkZpbmRGaXJzdENoaWxkKCJCb2R5Q2xpcCIpOkRlc3Ryb3koKQogICAgICAgIGVuZAogICAgICAgIF9HLlN0b3BUd2VlbiA9IGZhbHNlCiAgICAgICAgX0cuQ2xpcCA9IGZhbHNlCiAgICAgICAgZW5kCiAgICAgICAgZW5kCgpmdW5jdGlvbiBHZXREaXN0YW5jZShxKQogICAgaWYgdHlwZShxKSA9PSAiaW5zdGFuY2UiIHRoZW4KICAgICAgICBpZiBJbnN0YW5jZTpJc0EoIkJhc2VQYXJ0Iikgb3IgSW5zdGFuY2U6SXNBKCJQYXJ0IikgdGhlbgogICAgICAgICAgICByZXR1cm4gKHEuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgIGVsc2VpZiBJbnN0YW5jZTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIChxLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgIGVsc2UKICAgICAgICAgICAgZm9yIHIsIHYgaW4gcGFpcnMocTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgaWYgdjpJc0EoIkJhc2VQYXJ0Iikgb3IgdjpJc0EoIlBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh2LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICByZXR1cm4gKHEgLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgZW5kCmVuZAoKZnVuY3Rpb24gSW5NeU5ldFdvcmsob2JqZWN0KQoJaWYgaXNuZXR3b3Jrb3duZXIgdGhlbgoJCXJldHVybiBpc25ldHdvcmtvd25lcihvYmplY3QpCgllbHNlCgkJaWYgKG9iamVjdC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IF9HLkJyaW5nTW9kZSB0aGVuIAoJCQlyZXR1cm4gdHJ1ZQoJCWVuZAoJCXJldHVybiBmYWxzZQoJZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gcm91bmQobnVtKQogICAgcmV0dXJuIG1hdGguZmxvb3IobnVtICsgMC41KQplbmQKCmZ1bmN0aW9uIFVwZGF0ZURldmlsQ2hhbXMoKQogICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZS5Xb3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIERldmlsRnJ1aXRFU1AgdGhlbgogICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQodi5OYW1lLCAiRnJ1aXQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSGFuZGxlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGhhbmRsZSA9IHYuSGFuZGxlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXNwTmFtZSA9ICdOYW1lRXNwJyAuLiBOdW1iZXIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBub3QgaGFuZGxlOkZpbmRGaXJzdENoaWxkKGVzcE5hbWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYmlsbCA9IEluc3RhbmNlLm5ldygnQmlsbGJvYXJkR3VpJywgaGFuZGxlKQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLk5hbWUgPSBlc3BOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGwuRXh0ZW50c09mZnNldCA9IFZlY3RvcjMubmV3KDAsIDEsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGwuU2l6ZSA9IFVEaW0yLm5ldygxLCAyMDAsIDEsIDMwKQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLkFkb3JuZWUgPSBoYW5kbGUKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbC5BbHdheXNPblRvcCA9IHRydWUKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBJbnN0YW5jZS5uZXcoJ1RleHRMYWJlbCcsIGJpbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuRm9udCA9IEVudW0uRm9udC5Hb3RoYW1TZW1pYm9sZAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHRTaXplID0gMTQgCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuVGV4dFdyYXBwZWQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCAxLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHRZQWxpZ25tZW50ID0gRW51bS5UZXh0WUFsaWdubWVudC5Ub3AKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHRTdHJva2VUcmFuc3BhcmVuY3kgPSAwLjUKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiJXNcbiVkIERpc3RhbmNlIiwgdi5OYW1lLCByb3VuZCgoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuUG9zaXRpb24gLSBoYW5kbGUuUG9zaXRpb24pLk1hZ25pdHVkZSAvIDMpKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmFtZSA9IGhhbmRsZVtlc3BOYW1lXS5UZXh0TGFiZWwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiJXNcbiVkIERpc3RhbmNlIiwgdi5OYW1lLCByb3VuZCgoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuUG9zaXRpb24gLSBoYW5kbGUuUG9zaXRpb24pLk1hZ25pdHVkZSAvIDMpKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkhhbmRsZSIpIGFuZCB2LkhhbmRsZTpGaW5kRmlyc3RDaGlsZCgnTmFtZUVzcCcgLi4gTnVtYmVyKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdi5IYW5kbGVbJ05hbWVFc3AnIC4uIE51bWJlcl06RGVzdHJveSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZAoKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICBpZiBfRy5Ud2VlbmZydWl0IHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJUb29sIikgYW5kIHN0cmluZy5maW5kKHYuTmFtZSwgIkZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0Iix2OkdldEF0dHJpYnV0ZSgiT3JpZ2luYWxOYW1lIiksdikKICAgICAgICAgICAgICAgICAgICAgICAgTG9hZC5UZXh0ID0gIktlZXAgRnJ1aXQgU3VjY2VzcyIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJUb29sIikgYW5kIHN0cmluZy5maW5kKHYuTmFtZSwgIkZydWl0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdG9yZUZydWl0Iix2OkdldEF0dHJpYnV0ZSgiT3JpZ2luYWxOYW1lIiksdikKICAgICAgICAgICAgICAgICAgICAgICAgTG9hZC5UZXh0ID0gIktlZXAgRnJ1aXQgU3VjY2VzcyIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKZnVuY3Rpb24gSG9wKCkKICAgIGxvY2FsIFBsYWNlSUQgPSBnYW1lLlBsYWNlSWQKICAgIGxvY2FsIEpvYklEID0gZ2FtZS5Kb2JJZAogICAgbG9jYWwgQWxsSURzID0ge30KICAgIGxvY2FsIEN1cnNvciA9ICIiCiAgICBsb2NhbCBIb3VyID0gb3MuZGF0ZSgiISp0IikuaG91cgogICAgCiAgICBsb2NhbCBmdW5jdGlvbiBTYXZlSURzKCkKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHdyaXRlZmlsZSgiTm90U2FtZVNlcnZlcnMuanNvbiIsIGdhbWU6R2V0U2VydmljZSgiSHR0cFNlcnZpY2UiKTpKU09ORW5jb2RlKEFsbElEcykpCiAgICAgICAgZW5kKQogICAgZW5kCiAgICBsb2NhbCBmdW5jdGlvbiBMb2FkSURzKCkKICAgICAgICBsb2NhbCBzdWNjZXNzLCBkYXRhID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gcmVhZGZpbGUoIk5vdFNhbWVTZXJ2ZXJzLmpzb24iKQogICAgICAgIGVuZCkKICAgICAgICBpZiBzdWNjZXNzIHRoZW4KICAgICAgICAgICAgQWxsSURzID0gZ2FtZTpHZXRTZXJ2aWNlKCJIdHRwU2VydmljZSIpOkpTT05EZWNvZGUoZGF0YSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIEFsbElEcyA9IHtIb3VyfQogICAgICAgICAgICBTYXZlSURzKCkKICAgICAgICBlbmQKICAgIGVuZAogICAgbG9jYWwgZnVuY3Rpb24gQ2hlY2tGb3JGcnVpdCgpCiAgICAgICAgbG9jYWwgaGFzRnJ1aXQgPSBmYWxzZQogICAgICAgIGZvciBfLCB2IGluIHBhaXJzKHdvcmtzcGFjZTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiB2OklzQSgiTW9kZWwiKSBhbmQgdi5OYW1lOmxvd2VyKCk6ZmluZCgiZnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBoYXNGcnVpdCA9IHRydWUKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHJldHVybiBoYXNGcnVpdAogICAgZW5kCiAgICBsb2NhbCBmdW5jdGlvbiBUUFJldHVybmVyKCkKICAgICAgICBsb2NhbCBTaXRlCiAgICAgICAgaWYgQ3Vyc29yID09ICIiIHRoZW4KICAgICAgICAgICAgU2l0ZSA9IGdhbWUuSHR0cFNlcnZpY2U6SlNPTkRlY29kZShnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vZ2FtZXMucm9ibG94LmNvbS92MS9nYW1lcy8nIC4uIFBsYWNlSUQgLi4gJy9zZXJ2ZXJzL1B1YmxpYz9zb3J0T3JkZXI9QXNjJmxpbWl0PTEwMCcpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgU2l0ZSA9IGdhbWUuSHR0cFNlcnZpY2U6SlNPTkRlY29kZShnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vZ2FtZXMucm9ibG94LmNvbS92MS9nYW1lcy8nIC4uIFBsYWNlSUQgLi4gJy9zZXJ2ZXJzL1B1YmxpYz9zb3J0T3JkZXI9QXNjJmxpbWl0PTEwMCZjdXJzb3I9JyAuLiBDdXJzb3IpKQogICAgICAgIGVuZAogICAgICAgIGlmIFNpdGUubmV4dFBhZ2VDdXJzb3IgdGhlbgogICAgICAgICAgICBDdXJzb3IgPSBTaXRlLm5leHRQYWdlQ3Vyc29yCiAgICAgICAgZW5kCiAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoU2l0ZS5kYXRhKSBkbwogICAgICAgICAgICBsb2NhbCBJRCA9IHRvc3RyaW5nKHYuaWQpCiAgICAgICAgICAgIGlmIHRvbnVtYmVyKHYubWF4UGxheWVycykgPiB0b251bWJlcih2LnBsYXlpbmcpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGFscmVhZHlWaXNpdGVkID0gZmFsc2UKICAgICAgICAgICAgICAgIGZvciBfLCBleGlzdGluZyBpbiBwYWlycyhBbGxJRHMpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgSUQgPT0gZXhpc3RpbmcgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBhbHJlYWR5VmlzaXRlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIG5vdCBhbHJlYWR5VmlzaXRlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KEFsbElEcywgSUQpCiAgICAgICAgICAgICAgICAgICAgU2F2ZUlEcygpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJUZWxlcG9ydFNlcnZpY2UiKTpUZWxlcG9ydFRvUGxhY2VJbnN0YW5jZShQbGFjZUlELCBJRCwgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyKQogICAgICAgICAgICAgICAgICAgIHdhaXQoNSkgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgQ2hlY2tGb3JGcnVpdCgpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkZydWl0IGZvdW5kIGluIHNlcnZlcjoiLCBJRCkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJObyBmcnVpdCBmb3VuZCwgc2VhcmNoaW5nIG5leHQgc2VydmVyLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZShBbGxJRHMsICNBbGxJRHMpIAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gVGVsZXBvcnRMb29wKCkKICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgcGNhbGwoVFBSZXR1cm5lcikKICAgICAgICBlbmQKICAgIGVuZAogICAgTG9hZElEcygpCiAgICBUZWxlcG9ydExvb3AoKQplbmQKCiAgICAKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCguMSkgZG8KICAgICAgICBpZiBfRy5Ud2VlbmZydWl0IHRoZW4KICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQodi5OYW1lLCAiRnJ1aXQiKSB0aGVuCiAgICAgICAgICAgICAgICBVcGRhdGVEZXZpbENoYW1zKCkKICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2LkhhbmRsZS5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHdhaXQoNikKICAgICAgICAgICAgICAgICAgICBIb3AoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIHdhaXQoLjEpIGRvCiAgICAgICAgICAgICAgICBpZiBfRy5Ud2VlbmZydWl0IHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJDb3VzaW4iLCJCdXkiKQogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQpCiAgICAKc3Bhd24oZnVuY3Rpb24oKQoJd2hpbGUgd2FpdCgpIGRvCgkJaWYgUmVqb2luX0Jvb3N0IHRoZW4KCQkJCWdldGdlbnYoKS5yZWpvaW4gPSBnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKS5Sb2Jsb3hQcm9tcHRHdWkucHJvbXB0T3ZlcmxheS5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCgkJCQkJaWYgY2hpbGQuTmFtZSA9PSAnRXJyb3JQcm9tcHQnIGFuZCBjaGlsZDpGaW5kRmlyc3RDaGlsZCgnTWVzc2FnZUFyZWEnKSBhbmQgY2hpbGQuTWVzc2FnZUFyZWE6RmluZEZpcnN0Q2hpbGQoIkVycm9yRnJhbWUiKSB0aGVuCgkJCQkJCWdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIik6VGVsZXBvcnQoZ2FtZS5QbGFjZUlkKQoJCQkJCWVuZAoJCQkJIGVuZCkKCQkJZW5kCgkJZW5kCgllbmQpCgkKc3Bhd24oZnVuY3Rpb24oKQoJd2hpbGUgd2FpdCgpIGRvCgkJaWYgUmVqb2luX0Jvb3N0IHRoZW4KCQkJcGNhbGwoZnVuY3Rpb24oKQoJCQkJZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk5vdGlmaWNhdGlvbnMuRW5hYmxlZCA9IGZhbHNlCgkJCQkKCQkJCXNoYXJlZCA9IHt9CgkJCQlzaGFyZWQuQkNfMSA9IHRydWUKCQkJCXNoYXJlZC5CQ18yID0gbmlsCgoJCQkJaWYgc2hhcmVkLkJDXzEgYW5kIHNoYXJlZC5CQ18yID09IG5pbCB0aGVuCgkJCQkJbG9jYWwgV29ya3NwYWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKQoJCQkJCWxvY2FsIExpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpCgkJCQkJbG9jYWwgVGVycmFpbiA9IFdvcmtzcGFjZS5UZXJyYWluCgkJCQkJbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCgkJCQkJbG9jYWwgQ2hhcmFjdGVyID0gUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIgb3IgUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCgkJCQkJVGVycmFpbi5XYXRlcldhdmVTaXplID0gMAoJCQkJCVRlcnJhaW4uV2F0ZXJXYXZlU3BlZWQgPSAwCgkJCQkJVGVycmFpbi5XYXRlclJlZmxlY3RhbmNlID0gMAoJCQkJCVRlcnJhaW4uV2F0ZXJUcmFuc3BhcmVuY3kgPSAwCgoJCQkJCUxpZ2h0aW5nLkdsb2JhbFNoYWRvd3MgPSBmYWxzZQoJCQkJCUxpZ2h0aW5nLkZvZ0VuZCA9IG1hdGguaHVnZQoJCQkJCUxpZ2h0aW5nLkJyaWdodG5lc3MgPSAwCgoJCQkJCXNldHRpbmdzKCkuUmVuZGVyaW5nLlF1YWxpdHlMZXZlbCA9IEVudW0uUXVhbGl0eUxldmVsLkxldmVsMDEKCQkJCQlzZXR0aW5ncygpLlJlbmRlcmluZy5HcmFwaGljc01vZGUgPSBFbnVtLkdyYXBoaWNzTW9kZS5Ob0dyYXBoaWNzCgoJCQkJCWZvciBfLCB2IGluIHBhaXJzKFdvcmtzcGFjZTpHZXREZXNjZW5kYW50cygpKSBkbwoJCQkJCQlpZiB2OklzQSgiQmFzZVBhcnQiKSB0aGVuCgkJCQkJCQl2Lk1hdGVyaWFsID0gRW51bS5NYXRlcmlhbC5QbGFzdGljCgkJCQkJCQl2LlJlZmxlY3RhbmNlID0gMAoJCQkJCQkJdi5DYXN0U2hhZG93ID0gZmFsc2UKCQkJCQkJZWxzZWlmIHY6SXNBKCJEZWNhbCIpIG9yIHY6SXNBKCJUZXh0dXJlIikgdGhlbgoJCQkJCQkJdi5UZXh0dXJlID0gIiIKCQkJCQkJCXYuVHJhbnNwYXJlbmN5ID0gMQoJCQkJCQllbHNlaWYgdjpJc0EoIlBhcnRpY2xlRW1pdHRlciIpIG9yIHY6SXNBKCJUcmFpbCIpIHRoZW4KCQkJCQkJCXYuTGlnaHRJbmZsdWVuY2UgPSAwCgkJCQkJCQl2LlRleHR1cmUgPSAiIgoJCQkJCQkJdi5MaWZldGltZSA9IE51bWJlclJhbmdlLm5ldygwKQoJCQkJCQllbHNlaWYgdjpJc0EoIkV4cGxvc2lvbiIpIHRoZW4KCQkJCQkJCXYuQmxhc3RQcmVzc3VyZSA9IDAKCQkJCQkJCXYuQmxhc3RSYWRpdXMgPSAwCgkJCQkJCWVsc2VpZiB2OklzQSgiRmlyZSIpIG9yIHY6SXNBKCJTcG90TGlnaHQiKSBvciB2OklzQSgiU21va2UiKSBvciB2OklzQSgiU3BhcmtsZXMiKSB0aGVuCgkJCQkJCQl2LkVuYWJsZWQgPSBmYWxzZQoJCQkJCQllbHNlaWYgdjpJc0EoIk1lc2hQYXJ0IikgdGhlbgoJCQkJCQkJdi5NYXRlcmlhbCA9IEVudW0uTWF0ZXJpYWwuUGxhc3RpYwoJCQkJCQkJdi5SZWZsZWN0YW5jZSA9IDAKCQkJCQkJCXYuVGV4dHVyZUlEID0gIiIKCQkJCQkJCXYuQ2FzdFNoYWRvdyA9IGZhbHNlCgkJCQkJCQl2LlJlbmRlckZpZGVsaXR5ID0gRW51bS5SZW5kZXJGaWRlbGl0eS5QZXJmb3JtYW5jZQoJCQkJCQllbHNlaWYgdjpJc0EoIlNwZWNpYWxNZXNoIikgdGhlbgoJCQkJCQkJdi5UZXh0dXJlSUQgPSAiIgoJCQkJCQllbHNlaWYgdjpJc0EoIlNoaXJ0Iikgb3IgdjpJc0EoIlBhbnRzIikgb3IgdjpJc0EoIkFjY2Vzc29yeSIpIHRoZW4KCQkJCQkJCXY6RGVzdHJveSgpCgkJCQkJCWVuZAoJCQkJCWVuZAoKCQkJCQlmb3IgXywgdiBpbiBwYWlycyhMaWdodGluZzpHZXREZXNjZW5kYW50cygpKSBkbwoJCQkJCQlpZiB2OklzQSgiQmx1ckVmZmVjdCIpIG9yIHY6SXNBKCJTdW5SYXlzRWZmZWN0Iikgb3IgdjpJc0EoIkNvbG9yQ29ycmVjdGlvbkVmZmVjdCIpIG9yIHY6SXNBKCJCbG9vbUVmZmVjdCIpIG9yIHY6SXNBKCJEZXB0aE9mRmllbGRFZmZlY3QiKSB0aGVuCgkJCQkJCQl2LkVuYWJsZWQgPSBmYWxzZQoJCQkJCQllbmQKCQkJCQllbmQKCgkJCQkJZm9yIF8sIHYgaW4gcGFpcnMoQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCgkJCQkJCWlmIHY6SXNBKCJTaGlydCIpIG9yIHY6SXNBKCJQYW50cyIpIG9yIHY6SXNBKCJBY2Nlc3NvcnkiKSB0aGVuCgkJCQkJCQl2OkRlc3Ryb3koKQoJCQkJCQllbmQKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQpCgkJZW5kCgllbmQKZW5kKQoKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgaWYgX0cuVGVsZU1pcmFnZSB0aGVuCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcDpGaW5kRmlyc3RDaGlsZCgiTXlzdGljSXNsYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLk15c3RpY0lzbGFuZC5DZW50ZXIuUG9zaXRpb24uWCwKICAgICAgICAgICAgICAgICAgICAgICAgNTAwLAogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5NeXN0aWNJc2xhbmQuQ2VudGVyLlBvc2l0aW9uLloKICAgICAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbkxpYnJhcnk6U2VuZE5vdGlmaWNhdGlvbigiV2FybmluZyIsICJUd2VlbiBNaXJhZ2UgSXNsYW5kOiBPbiIsIDEwKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgoKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5Nb29uIHRoZW4KICAgICAgICAgICAgICAgIHdhaXQoMC41KQogICAgICAgICAgICAgICAgbG9jYWwgbW9vbkRpciA9IGdhbWUuTGlnaHRpbmc6R2V0TW9vbkRpcmVjdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCBsb29rQXRQb3MgPSBnYW1lLldvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5wICsgbW9vbkRpciAqIDEwMAogICAgICAgICAgICAgICAgZ2FtZS5Xb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUgPSBDRnJhbWUubG9va0F0KGdhbWUuV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lLnAsIGxvb2tBdFBvcykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCgpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgIGlmIF9HLlYzIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1FOkZpcmVTZXJ2ZXIoIkFjdGl2YXRlQWJpbGl0eSIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgoKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICBpZiBfRy5MdW9tX0dlYXIgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXA6RmluZEZpcnN0Q2hpbGQoIk15c3RpY0lzbGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5NeXN0aWNJc2xhbmQ6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIk1lc2hQYXJ0IikgYW5kIHYuTWF0ZXJpYWwgPT0gRW51bS5NYXRlcmlhbC5OZW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICAgICAgaWYgX0cuUHVsbExldmVyIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwOkZpbmRGaXJzdENoaWxkKCJNeXN0aWNJc2xhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgX0cuU3BlYWsgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgX0cuVHdlZW5mcnVpdCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgd2FpdCgzMCkKICAgICAgICAgICAgICAgICAgICBfRy5UZWxlTWlyYWdlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIF9HLk1vb24gPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgX0cuVjMgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuTXlzdGljSXNsYW5kOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJNZXNoUGFydCIpIGFuZCB2Lk1hdGVyaWFsID09IEVudW0uTWF0ZXJpYWwuTmVvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5MdW9tX0dlYXIgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5UZWxlTWlyYWdlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLk1vb24gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuVjMgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfRy5Ud2VlbmZydWl0ID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgoKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgaWYgX0cuU3BlYWsgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmdW5jdGlvbiB0b3BvcyhQb3MpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGlzdGFuY2UgPSAoUG9zLlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlNpdCA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5TaXQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW4gPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpOkNyZWF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuSW5mby5uZXcoRGlzdGFuY2UgLyAyNTAsIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgQ0ZyYW1lID0gUG9zIH0KICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICB0d2VlbjpQbGF5KCkKICAgICAgICAgICAgICAgICAgICBpZiBEaXN0YW5jZSA8PSAyNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0d2VlbjpDYW5jZWwoKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUG9zCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgX0cuU3RvcFR3ZWVuID09IHRydWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0d2VlbjpDYW5jZWwoKQogICAgICAgICAgICAgICAgICAgICAgICBfRy5DbGlwID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHR3byhnb3RvQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5TaXQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQW5jaG9yZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIilbIkxvY2FsUGxheWVyIl0uQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnb3RvQ0ZyYW1lLlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMjAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW56OkNhbmNlbCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIilbIkxvY2FsUGxheWVyIl0uQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gZ290b0NGcmFtZQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHdlZW5fcyA9IGdhbWU6c2VydmljZSgiVHdlZW5TZXJ2aWNlIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaW5mbyA9IFR3ZWVuSW5mby5uZXcoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIilbIkxvY2FsUGxheWVyIl0uQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnb3RvQ0ZyYW1lLlBvc2l0aW9uKS5NYWduaXR1ZGUgLyA5OTk5OTksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhcgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuLCBlcnIgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0d2VlbnogPSB0d2Vlbl9zOkNyZWF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyWyJIdW1hbm9pZFJvb3RQYXJ0Il0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IENGcmFtZSA9IGdvdG9DRnJhbWUgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW56OlBsYXkoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0d2VlbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgIFsxXSA9ICJyZXF1ZXN0RW50cmFuY2UiLAogICAgICAgICAgICAgICAgICAgIFsyXSA9IFZlY3RvcjMubmV3KC0xMjQ2My42MDI1MzkwNjI1LCAzNzguMzI3MDU2ODg0NzY1NiwgLTc1NjYuMDgzMDA3ODEyNSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICAgICAgICAgIHR3byhDRnJhbWUubmV3KC01MDQzLjkyNDMyLCAzMTYuMjA1NzgsIC0yOTk0LjI2OTA0KSkKICAgICAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTUzNTUuNjIyNTYsIDMxMy43MTU0ODUsIC0yNDk1LjE3MzgzKSkKICAgICAgICAgICAgICAgIHdhaXQoNCkKICAgICAgICAgICAgICAgIHR3byhDRnJhbWUubmV3KC01NTAxLjI4MzY5LCAxMDkwLjM5Mjk0LCAtMjQ2NS4yMzQzOCkpCiAgICAgICAgICAgICAgICB0d28oQ0ZyYW1lLm5ldygtNTg0NC4yODQxOCwgMTA3NC4xMDY4MSwgLTIxMDAuMDc0MjIpKQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAiUmFjZVY0UHJvZ3Jlc3MiLAogICAgICAgICAgICAgICAgICAgIFsyXSA9ICJDaGVjayIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkNvbW1GXyIpOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgIFsxXSA9ICJSYWNlVjRQcm9ncmVzcyIsCiAgICAgICAgICAgICAgICAgICAgWzJdID0gIkJlZ2luIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiQ29tbUZfIik6SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgIHdhaXQoMSkKCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygyODI4Ni4zNTU1LCAxNDg5Ni41MzUyLCAxMDIuNjI0Njk1KQogICAgICAgICAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygyODI4Ni4zNTU1LCAxNDg5Ni41MzUyLCAxMDIuNjI0Njk1KQogICAgICAgICAgICAgICAgd2FpdCgxKQogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoMjgyODYuMzU1NSwgMTQ4OTYuNTM1MiwgMTAyLjYyNDY5NSkKICAgICAgICAgICAgICAgIHdhaXQoMS41KQogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoMjgyODYuMzU1NSwgMTQ4OTYuNTM1MiwgMTAyLjYyNDY5NSkKICAgICAgICAgICAgICAgIHR3byhDRnJhbWUubmV3KDI4NjA4LjY5NTMsIDE0ODk4LjE4OTUsIDEwNS45ODI0ODMpKQogICAgICAgICAgICAgICAgd2FpdCgxKQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAiUmFjZVY0UHJvZ3Jlc3MiLAogICAgICAgICAgICAgICAgICAgIFsyXSA9ICJUZWxlcG9ydEJhY2siCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJDb21tRl8iKTpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQoKICAgICAgICAgICAgICAgIHdhaXQoMS41KQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAiUmFjZVY0UHJvZ3Jlc3MiLAogICAgICAgICAgICAgICAgICAgIFsyXSA9ICJUZWxlcG9ydCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkNvbW1GXyIpOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICB3YWl0KDIpCgogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAicmVxdWVzdEVudHJhbmNlIiwKICAgICAgICAgICAgICAgICAgICBbMl0gPSBWZWN0b3IzLm5ldygtMTI0NjMuNjAyNTM5MDYyNSwgMzc4LjMyNzA1Njg4NDc2NTYsIC03NTY2LjA4MzAwNzgxMjUpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICB3YWl0KDEpCiAgICAgICAgICAgICAgICB0d28oQ0ZyYW1lLm5ldygtNTA0My45MjQzMiwgMzE2LjIwNTc4LCAtMjk5NC4yNjkwNCkpCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC01MzU1LjYyMjU2LCAzMTMuNzE1NDg1LCAtMjQ5NS4xNzM4MykpCgogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAiUmFjZVY0UHJvZ3Jlc3MiLAogICAgICAgICAgICAgICAgICAgIFsyXSA9ICJDaGVjayIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkNvbW1GXyIpOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgIFsxXSA9ICJSYWNlVjRQcm9ncmVzcyIsCiAgICAgICAgICAgICAgICAgICAgWzJdID0gIkNvbnRpbnVlIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiQ29tbUZfIik6SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbkxpYnJhcnk6U2VuZE5vdGlmaWNhdGlvbigiV2FybmluZyIsICJDb21wbGV0ZWQgRnVuY3Rpb24iLCAxMCkKICAgICAgICAgICAgICAgIF9HLlNwZWFrID0gZmFsc2UKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCgo="
local decoded_script = base64.decode(encoded_script)
loadstring(decoded_script)()
